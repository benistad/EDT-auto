(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7804:(e,t,r)=>{"use strict";r.d(t,{default:()=>A});var a,l=r(5155),n=r(2115),s=r(2699),o=r.n(s),i=r(6597),c=r(5617),d=r(2354);let u="https://nklnqcpubrjutovtuvjt.supabase.co",m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rbG5xY3B1YnJqdXRvdnR1dmp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxMzQxNzQsImV4cCI6MjA3MTcxMDE3NH0.2Imrg7dJMqoD6J2U7eBpQjqDfVY5yOpvJmiSxxp4FvI";if(!u||!m)throw Error("Missing Supabase environment variables. Please check your .env.local file.");let x=(0,d.UU)(u,m);async function h(e){let{data:t,error:r}=await x.from("timetable_saves").insert([e]).select().single();if(r)throw r;return t}async function b(){let{data:e,error:t}=await x.from("timetable_saves").select("*").order("updated_at",{ascending:!1});if(t)throw t;return e||[]}async function g(e){let{error:t}=await x.from("timetable_saves").delete().eq("id",e);if(t)throw t}var p=r(3736),f=r(2480),y=r(1153);function v(e){let t=Math.max(0,Math.round(e||0)),r=Math.floor(t/60),a=t%60;return a>0?"".concat(r,"h").concat(a.toString().padStart(2,"0")):"".concat(r,"h")}window.process={...window.process,env:{...(null===(a=window.process)||void 0===a?void 0:a.env)||{},OPENAI_API_KEY:"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"}};let j=(0,f.r)({apiKey:"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"});async function N(e){try{console.log("[v0] Starting aggressive OKLCH cleanup and rasterization");let t=document.createElement("style");t.textContent="\n      * {\n        background-color: #ffffff !important;\n        color: #111111 !important;\n        border-color: #cccccc !important;\n        outline-color: transparent !important;\n        text-decoration-color: transparent !important;\n        box-shadow: none !important;\n      }\n      .bg-indigo-100 { background-color: #e0e7ff !important; }\n      .bg-rose-100 { background-color: #ffe4e6 !important; }\n      .bg-amber-100 { background-color: #fef3c7 !important; }\n      .bg-emerald-100 { background-color: #d1fae5 !important; }\n      .bg-pink-100 { background-color: #fce7f3 !important; }\n      .bg-sky-100 { background-color: #e0f2fe !important; }\n      .bg-teal-100 { background-color: #ccfbf1 !important; }\n      .bg-cyan-100 { background-color: #cffafe !important; }\n      .border-indigo-300 { border-color: #a5b4fc !important; }\n      .border-rose-300 { border-color: #fda4af !important; }\n      .border-amber-300 { border-color: #fcd34d !important; }\n      .border-emerald-300 { border-color: #6ee7b7 !important; }\n      .border-pink-300 { border-color: #f9a8d4 !important; }\n      .border-sky-300 { border-color: #7dd3fc !important; }\n      .border-teal-300 { border-color: #5eead4 !important; }\n      .border-cyan-300 { border-color: #67e8f9 !important; }\n      .bg-primary { background-color: #3b82f6 !important; }\n      .text-primary-foreground { color: #ffffff !important; }\n      .border-primary/20 { border-color: rgba(59, 130, 246, 0.2) !important; }\n      .bg-gradient-to-r { background: #e0f2fe !important; }\n      .from-cyan-100 { background: #e0f2fe !important; }\n      .to-amber-100 { background: #e0f2fe !important; }\n      .from-cyan-50 { background: #ecfeff !important; }\n      .to-amber-50 { background: #fffbeb !important; }\n    ",document.head.appendChild(t),await new Promise(e=>setTimeout(e,100)),console.log("[v0] Temporary override styles applied");let r=await o()(e,{scale:1.5,backgroundColor:"#ffffff",useCORS:!0,allowTaint:!0,logging:!1,removeContainer:!0,ignoreElements:e=>{let t=e.tagName.toLowerCase();return"script"===t||"style"===t||"noscript"===t},onclone:e=>{e.querySelectorAll("*").forEach(e=>{e.style&&(e.style.backgroundColor=e.style.backgroundColor||"#ffffff",e.style.color=e.style.color||"#111111",e.style.borderColor=e.style.borderColor||"#cccccc")})}});return console.log("[v0] Canvas generated:",r.width,"x",r.height),document.head.removeChild(t),console.log("[v0] Temporary styles removed"),r}catch(e){throw console.error("[v0] Erreur rasterization:",e),document.querySelectorAll("style").forEach(e=>{var t;(null===(t=e.textContent)||void 0===t?void 0:t.includes("background-color: #ffffff !important"))&&e.remove()}),e}}function k(e){if(!e||"string"!=typeof e)return 0;let[t,r]=e.split(":").map(Number);return(Number.isFinite(t)?t:0)*60+(Number.isFinite(r)?r:0)}function w(e){let t=Math.max(0,Math.round(e)),r=Math.floor(t/60),a=(t%60).toString().padStart(2,"0");return"".concat(r,":").concat(a)}function C(e,t,r,a){return Math.max(e,r)<Math.min(t,a)}function S(e,t){return new Promise((r,a)=>{let l=setTimeout(()=>a(Error("timeout")),t);e.then(e=>{clearTimeout(l),r(e)}).catch(e=>{clearTimeout(l),a(e)})})}console.log("[v0] OpenAI key present:",!0);let D={C2:[{key:"fr",label:"Fran\xe7ais",minutes:550},{key:"maths",label:"Math\xe9matiques",minutes:275},{key:"lv",label:"Langues vivantes",minutes:80},{key:"eps",label:"EPS",minutes:165},{key:"arts",label:"Arts",minutes:110},{key:"qlm_emc",label:"QLM + EMC",minutes:140}],C3:[{key:"fr",label:"Fran\xe7ais",minutes:440},{key:"maths",label:"Math\xe9matiques",minutes:275},{key:"lv",label:"Langues vivantes",minutes:80},{key:"eps",label:"EPS",minutes:165},{key:"sciences",label:"Sciences & techno",minutes:110},{key:"arts",label:"Arts",minutes:110},{key:"hg_emc",label:"Histoire-G\xe9o + EMC",minutes:140}]},E={CP:"C2",CE1:"C2",CE2:"C2",CM1:"C3",CM2:"C3"},M=[{key:"Mon",label:"Lundi",enabled:!0,morningStart:"08:30",lunchStart:"12:00",lunchEnd:"13:30",dayEnd:"16:30",rec1Start:"10:15",rec1Dur:15,rec2Start:"15:00",rec2Dur:15},{key:"Tue",label:"Mardi",enabled:!0,morningStart:"08:30",lunchStart:"12:00",lunchEnd:"13:30",dayEnd:"16:30",rec1Start:"10:15",rec1Dur:15,rec2Start:"15:00",rec2Dur:15},{key:"Wed",label:"Mercredi",enabled:!1,morningStart:"08:30",lunchStart:"12:00",lunchEnd:"13:30",dayEnd:"16:30",rec1Start:"10:15",rec1Dur:15,rec2Start:"15:00",rec2Dur:15},{key:"Thu",label:"Jeudi",enabled:!0,morningStart:"08:30",lunchStart:"12:00",lunchEnd:"13:30",dayEnd:"16:30",rec1Start:"10:15",rec1Dur:15,rec2Start:"15:00",rec2Dur:15},{key:"Fri",label:"Vendredi",enabled:!0,morningStart:"08:30",lunchStart:"12:00",lunchEnd:"13:30",dayEnd:"16:30",rec1Start:"10:15",rec1Dur:15,rec2Start:"15:00",rec2Dur:15}],I=[{key:"classic",name:"Classique",header:"bg-primary text-primary-foreground",card:"border-primary/20",gridBg:"bg-white"},{key:"pastel",name:"Pastel",header:"bg-accent text-accent-foreground",card:"border-accent/20",gridBg:"bg-accent/5"},{key:"mono",name:"Monochrome",header:"bg-foreground text-background",card:"border-border",gridBg:"bg-white"}],T={fr:"bg-indigo-100 border-indigo-300",maths:"bg-rose-100 border-rose-300",lv:"bg-amber-100 border-amber-300",eps:"bg-emerald-100 border-emerald-300",arts:"bg-pink-100 border-pink-300",qlm_emc:"bg-sky-100 border-sky-300",sciences:"bg-teal-100 border-teal-300",hg_emc:"bg-cyan-100 border-cyan-300",autre:"bg-gray-100 border-gray-300"};function A(){let[e,t]=(0,n.useState)(1),[r,a]=(0,n.useState)("CM1"),[s,o]=(0,n.useState)(()=>{{let e=localStorage.getItem("edt_days_v2");if(e)return JSON.parse(e)}return M}),[d,u]=(0,n.useState)(()=>{{let e=localStorage.getItem("edt_blocks_v2");if(e)return JSON.parse(e)}return[]}),[m,x]=(0,n.useState)(()=>{{let e=localStorage.getItem("edt_custom_subjects_v2");if(e)try{let t=JSON.parse(e);if(Array.isArray(t))return t}catch(e){}}return null}),[f,A]=(0,n.useState)(!1),[R,z]=(0,n.useState)([]),[_,F]=(0,n.useState)(null),[O,P]=(0,n.useState)("classic"),[J,q]=(0,n.useState)(""),[L,U]=(0,n.useState)(!1),B=(0,n.useRef)(null),X=(0,n.useRef)(null),[G,H]=(0,n.useState)([]),[Q,Y]=(0,n.useState)(!1),[W,Z]=(0,n.useState)(""),[V,K]=(0,n.useState)(!1);(0,n.useEffect)(()=>{u(e=>e.map(e=>{var t,r;return e&&e.id?e:{...e,id:(null===(r=globalThis.crypto)||void 0===r?void 0:null===(t=r.randomUUID)||void 0===t?void 0:t.call(r))||"".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),subtitle:(null==e?void 0:e.subtitle)||""}}))},[]);let $=E[r],ee=m||D[$],et=(0,n.useMemo)(()=>Object.fromEntries(s.map(e=>[e.key,e])),[s]),er=s.filter(e=>e.enabled);(0,n.useEffect)(()=>{localStorage.setItem("edt_days_v2",JSON.stringify(s))},[s]),(0,n.useEffect)(()=>{localStorage.setItem("edt_blocks_v2",JSON.stringify(d))},[d]),(0,n.useEffect)(()=>{m?localStorage.setItem("edt_custom_subjects_v2",JSON.stringify(m)):localStorage.removeItem("edt_custom_subjects_v2")},[m]);let ea=(0,n.useMemo)(()=>{let e={};return ee.forEach(t=>e[t.key]=t.minutes),e},[ee]),el=(0,n.useMemo)(()=>{let e={};return d.forEach(t=>{let r=Math.max(0,k(t.end)-k(t.start));e[t.subject]=(e[t.subject]||0)+r}),e},[d]),en=(0,n.useMemo)(()=>{let e={};return ee.forEach(t=>e[t.key]=(ea[t.key]||0)-(el[t.key]||0)),e},[ee,ea,el]),es={lundi:"Mon",monday:"Mon",mon:"Mon",mardi:"Tue",tuesday:"Tue",tue:"Tue",mercredi:"Wed",wednesday:"Wed",wed:"Wed",jeudi:"Thu",thursday:"Thu",thu:"Thu",vendredi:"Fri",friday:"Fri",fri:"Fri"};function eo(e){return(e||"").normalize("NFD").replace(RegExp("\\p{Diacritic}+","gu"),"").toLowerCase().trim()}function ei(e){if(!e)return"00:00";let t=String(e).match(/(\d{1,2})\s*[:hH]\s*(\d{2})/);if(t){let e=Math.max(0,Math.min(23,parseInt(t[1],10))),r=Math.max(0,Math.min(59,parseInt(t[2],10)));return"".concat(e,":").concat(r.toString().padStart(2,"0"))}let r=String(e).match(/^(\d{1,2})$/);if(r){let e=Math.max(0,Math.min(23,parseInt(r[1],10)));return"".concat(e,":00")}return e}function ec(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=[],r=[];for(let n of e||[]){var a,l;let e=function(e){let t=eo(e);return es[t]||(er.some(e=>eo(e.key)===t)?e:null)}(n.day)||es[eo(n.day)]||n.day,s=function(e){var t;if(!e)return"autre";let r=eo(e);if(ee.some(t=>t.key===e))return e;let a=ee.find(e=>eo(e.label)===r);return a?a.key:(null===(t=ee[0])||void 0===t?void 0:t.key)||"autre"}(n.subject),o={day:e,subject:s,start:ei(n.start),end:ei(n.end),subtitle:n.subtitle||""},i=eb(o);if(i){r.push({block:o,reason:i});continue}t.push({...o,id:(null===(l=globalThis.crypto)||void 0===l?void 0:null===(a=l.randomUUID)||void 0===a?void 0:a.call(l))||"".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2))})}return r.length&&console.log("[v0] Dropped AI blocks:",r),t}async function ed(){if(!W.trim()){alert("Veuillez entrer un nom pour la sauvegarde");return}if(G.map(e=>e.name.toLowerCase()).includes(W.trim().toLowerCase())){alert("La sauvegarde existe d\xe9j\xe0, choisissez un autre nom");return}K(!0);try{let e={name:W.trim(),class_name:r,days_config:s,blocks:d,subjects:ee};await h(e);let t=await b();H(t),Y(!1),Z(""),alert("Emploi du temps sauvegard\xe9 avec succ\xe8s !")}catch(e){console.error("Erreur lors de la sauvegarde:",e),alert("Erreur lors de la sauvegarde")}finally{K(!1)}}async function eu(e){try{a(e.class_name),o(e.days_config),u(e.blocks),x(e.subjects),alert('Emploi du temps "'.concat(e.name,'" charg\xe9 avec succ\xe8s !'))}catch(e){console.error("Erreur lors du chargement:",e),alert("Erreur lors du chargement")}}async function em(e,t){if(confirm('\xcates-vous s\xfbr de vouloir supprimer "'.concat(t,'" ?')))try{await g(e);let t=await b();H(t),alert("Sauvegarde supprim\xe9e")}catch(e){console.error("Erreur lors de la suppression:",e),alert("Erreur lors de la suppression")}}function ex(e){let t=k(e.rec1Start),r=t+(e.rec1Dur||0),a=k(e.rec2Start),l=a+(e.rec2Dur||0);return[[t,r],[a,l]]}function eh(e){let t=k(e.morningStart),r=k(e.lunchStart),a=k(e.lunchEnd),l=k(e.dayEnd),n=[];return t<r&&n.push([t,r]),a<l&&n.push([a,l]),n}function eb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=et[e.day];if(!r||!r.enabled)return"Jour d\xe9sactiv\xe9.";let a=k(e.start),l=k(e.end);return l<=a?"Fin avant d\xe9but.":eh(r).some(e=>{let[t,r]=e;return t<=a&&l<=r})?!function(e,t,r){let a=k(e.rec1Start),l=a+(e.rec1Dur||0),n=k(e.rec2Start),s=n+(e.rec2Dur||0);return t<l&&r>a&&r!==a&&t!==l||t<s&&r>n&&r!==n&&t!==s}(r,a,l)?d.filter(r=>r.day===e.day&&r.id!==t).some(e=>C(a,l,k(e.start),k(e.end)))?"Chevauche un autre cr\xe9neau.":null:"Chevauche une r\xe9cr\xe9ation.":"Hors des heures de classe (cantine ou hors plage)."}function eg(e,t){u(r=>r.map(r=>r.id===e?{...r,...t}:r))}(0,n.useEffect)(()=>{!async function(){try{let e=await b();H(e)}catch(e){console.error("Erreur lors du chargement des sauvegardes:",e)}}()},[]);let ep=e=>u(t=>t.filter(t=>t.id!==e)),ef=(e,t)=>{let r;let a=er.findIndex(t=>t.key===e.day);if("left"===t?r=a-1:"right"===t&&(r=a+1),r<0||r>=er.length)return;let l=er[r].key,n={...e,id:Date.now()+Math.random(),day:l},s=eb(n);s?console.log("Cannot duplicate block: conflict detected",s):u(e=>[...e,n])};function ey(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,a=et[e];if(!a)return null;let l=eh(a),n=new Set;for(let s=0;s<=240;s+=5)for(let o of 0===s?[t]:[t+s,t-s]){if(n.has(o))continue;n.add(o);let t=o+r;if(!l.some(e=>{let[r,a]=e;return r<=o&&t<=a}))continue;let s={day:e,start:w(o),end:w(t),subject:ee[0].key};if(!function(e,t,r){return ex(e).some(e=>{let[a,l]=e;return C(t,r,a,l)})}(a,o,t)&&!eb(s))return o}return null}function ev(e){var t;let{block:r,zoneStart:a,zoneEnd:n}=e,{id:s,subject:o}=r,i=T[o]||T.autre,d=k(r.start),u=Math.max(60,(k(r.end)-d)*2);return(0,l.jsx)(c.p,{bounds:"parent",cancel:".no-drag",enableResizing:{top:!0,bottom:!0,left:!1,right:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},size:{width:"100%",height:u},position:{x:0,y:(d-a)*2},onDragStop:(e,t)=>{let l=a+5*Math.round(t.y/2/5),n=k(r.end)-k(r.start),o=l+n,i={...r,start:w(l),end:w(o)},c=eb(i,s);if(c){let e=ey(r.day,l,n);null!==e?eg(s,{start:w(e),end:w(e+n)}):console.log("[v0] Drag conflict:",c)}else eg(s,{start:i.start,end:i.end})},onResizeStop:(e,t,l,n,o)=>{let i=Number.parseInt(l.style.height),c=a+5*Math.round(o.y/2/5),d=Math.max(5,5*Math.round(i/2/5)),u=c+d,m={...r,start:w(c),end:w(u)},x=eb(m,s);if(x){let e=ey(r.day,c,d);null!==e?eg(s,{start:w(e),end:w(e+d)}):console.log("[v0] Resize conflict:",x)}else eg(s,{start:m.start,end:m.end})},dragGrid:[1,10],resizeGrid:[1,10],className:"".concat(i," border-2 rounded-lg shadow-sm cursor-move overflow-hidden relative"),children:(0,l.jsxs)("div",{className:"p-2 h-full flex",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"font-medium text-sm text-gray-900 truncate",children:(null===(t=ee.find(e=>e.key===o))||void 0===t?void 0:t.label)||o}),(0,l.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[w(k(r.start))," - ",w(k(r.end))," (",v(k(r.end)-k(r.start)),")"]}),r.subtitle&&(0,l.jsx)("div",{className:"text-xs text-gray-500 truncate mt-2",children:r.subtitle})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 no-drag",children:[(0,l.jsxs)("div",{className:"flex gap-1",children:[er.findIndex(e=>e.key===r.day)>0&&(0,l.jsx)("button",{onClick:()=>ef(r,"left"),className:"w-5 h-5 bg-gray-500 hover:bg-gray-600 text-white rounded text-xs flex items-center justify-center transition-colors",title:"Dupliquer \xe0 gauche",children:"←"}),er.findIndex(e=>e.key===r.day)<er.length-1&&(0,l.jsx)("button",{onClick:()=>ef(r,"right"),className:"w-5 h-5 bg-gray-500 hover:bg-gray-600 text-white rounded text-xs flex items-center justify-center transition-colors",title:"Dupliquer \xe0 droite",children:"→"})]}),(0,l.jsx)("button",{onClick:()=>F(r),className:"w-6 h-6 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs flex items-center justify-center transition-colors",title:"\xc9diter",children:"✏️"}),(0,l.jsx)("button",{onClick:()=>ep(s),className:"w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded text-xs flex items-center justify-center transition-colors",title:"Supprimer",children:"\uD83D\uDDD1️"})]})]})})}let ej=async()=>{if(console.log("[v0] doAutoFill called"),L){console.log("[v0] doAutoFill ignored: already exporting");return}console.log("[v0] Starting AI generation (no confirm), clearing blocks"),u([]),U(!0);try{let e=ee.map(e=>"".concat(e.key,': "').concat(e.label,'" (').concat(v(e.minutes),")")).join(", "),t=et[er[0].key],a=w(k(t.rec1Start)+(t.rec1Dur||0)),l=w(k(t.rec2Start)+(t.rec2Dur||0)),n="Tu es un expert en p\xe9dagogie fran\xe7aise. Cr\xe9e un emploi du temps optimal pour une classe de ".concat(r," (").concat($,").\n\nCONTRAINTES OBLIGATOIRES :\n- Respecter exactement les volumes horaires : ").concat(e,"\n- Jours d'\xe9cole (cl\xe9s \xe0 utiliser): ").concat(er.map(e=>e.key).join(", "),"\n- Horaires : ").concat(t.morningStart," - ").concat(t.dayEnd,"\n- R\xe9cr\xe9ations : ").concat(t.rec1Start,"-").concat(a," et ").concat(t.rec2Start,"-").concat(l,"\n- Cantine : ").concat(t.lunchStart,"-").concat(t.lunchEnd,"\n\nIMPORTANT :\n- Utilise EXACTEMENT ces cl\xe9s de mati\xe8res: ").concat(ee.map(e=>e.key).join(", "),"\n- Utilise EXACTEMENT ces cl\xe9s de jours: ").concat(er.map(e=>e.key).join(", "),'\n\nBONNES PRATIQUES :\n- Fran\xe7ais le matin (concentration maximale)\n- EPS apr\xe8s la cantine ou en fin de journ\xe9e\n- Alternance mati\xe8res intellectuelles/physiques\n- Math\xe9matiques quand les enfants sont concentr\xe9s\n- Arts en fin de journ\xe9e possible\n\nFORMAT DE SORTIE STRICT:\n{\n  "blocks": [\n    { "day": "Mon", "subject": "fr", "start": "08:30", "end": "09:30", "subtitle": "" }\n  ]\n}\n\nG\xe9n\xe8re un emploi du temps complet et \xe9quilibr\xe9.');console.log("[v0] Calling OpenAI API with prompt:",n);let s=await S((0,p.pY)({model:j("gpt-4o"),prompt:n,schema:y.z.object({blocks:y.z.array(y.z.object({day:y.z.string(),subject:y.z.string(),start:y.z.string(),end:y.z.string(),subtitle:y.z.string().optional().default("")}))})}),45e3);console.log("[v0] AI response received:",JSON.stringify(s.object));let o=ec(s.object.blocks);console.log("[v0] Setting new blocks:",o),u(o)}catch(e){console.error("[v0] AI generation failed:",e),(null==e?void 0:e.message)==="timeout"?alert("Temps d'attente d\xe9pass\xe9 pour la g\xe9n\xe9ration. R\xe9essayez dans un instant."):alert("Erreur lors de la g\xe9n\xe9ration automatique. V\xe9rifiez que votre cl\xe9 API OpenAI est configur\xe9e dans les param\xe8tres du projet.")}finally{U(!1)}},eN=async()=>{if(console.log("[v0] doSmartAutoFill called"),L){console.log("[v0] doSmartAutoFill ignored: already exporting");return}U(!0);try{let e=d.filter(e=>!["R\xe9cr\xe9ation","D\xe9jeuner"].includes(e.subject)).map(e=>"".concat(e.day," ").concat(e.start,"-").concat(e.end,": ").concat(e.subject)).join(", "),t=ee.map(e=>"".concat(e.key,': "').concat(e.label,'" (').concat(v(e.minutes),")")).join(", "),a=et[er[0].key],l=w(k(a.rec1Start)+(a.rec1Dur||0)),n=w(k(a.rec2Start)+(a.rec2Dur||0)),s="Tu es un expert en p\xe9dagogie fran\xe7aise. Compl\xe8te intelligemment cet emploi du temps de ".concat(r," (").concat($,").\n\nCR\xc9NEAUX D\xc9J\xc0 OCCUP\xc9S : ").concat(e||"Aucun","\n\nCONTRAINTES :\n- Respecter les volumes horaires : ").concat(t,"\n- Jours (cl\xe9s \xe0 utiliser) : ").concat(er.map(e=>e.key).join(", "),"\n- Horaires : ").concat(a.morningStart," - ").concat(a.dayEnd,"\n- R\xe9cr\xe9ations : ").concat(a.rec1Start,"-").concat(l," et ").concat(a.rec2Start,"-").concat(n,"\n- Cantine : ").concat(a.lunchStart,"-").concat(a.lunchEnd,"\n\nIMPORTANT : \n- Utilise EXACTEMENT ces cl\xe9s de mati\xe8res: ").concat(ee.map(e=>e.key).join(", "),"\n- Utilise EXACTEMENT ces cl\xe9s de jours: ").concat(er.map(e=>e.key).join(", "),'\n- NE PAS modifier les cr\xe9neaux existants\n- Remplir seulement les espaces libres\n- Respecter les bonnes pratiques p\xe9dagogiques\n\nFORMAT DE SORTIE STRICT:\n{\n  "blocks": [\n    { "day": "Mon", "subject": "maths", "start": "10:30", "end": "11:15", "subtitle": "" }\n  ]\n}\n\nG\xe9n\xe8re UNIQUEMENT les nouveaux cr\xe9neaux \xe0 ajouter.');console.log("[v0] Calling OpenAI API for smart fill with prompt:",s);let o=await S((0,p.pY)({model:j("gpt-4o"),prompt:s,schema:y.z.object({blocks:y.z.array(y.z.object({day:y.z.string(),subject:y.z.string(),start:y.z.string(),end:y.z.string(),subtitle:y.z.string().optional().default("")}))})}),45e3);console.log("[v0] Smart fill AI response received:",JSON.stringify(o.object));let i=ec(o.object.blocks,d);console.log("[v0] Adding smart fill blocks:",i),u(e=>[...e,...i])}catch(e){console.error("[v0] Smart fill failed:",e),(null==e?void 0:e.message)==="timeout"?alert("Temps d'attente d\xe9pass\xe9 pour le remplissage intelligent. R\xe9essayez dans un instant."):alert("Erreur lors du remplissage intelligent. V\xe9rifiez que votre cl\xe9 API OpenAI est configur\xe9e dans les param\xe8tres du projet.")}finally{U(!1)}};async function ek(){console.log("[v0] doExport called, exportTitle:",J);let e=J.trim()||"Emploi_du_temps_".concat(r,"_").concat(new Date().toISOString().split("T")[0]);console.log("[v0] Final title:",e),console.log("[v0] exportRef.current:",B.current),console.log("[v0] summaryRef.current:",X.current),U(!0);try{let t=new i.Ay("landscape","mm","a4");if(B.current){console.log("[v0] Rasterizing main timetable...");let e=await N(B.current),r=e.toDataURL("image/png"),a=267/(e.width/2),l=160/(e.height/2),n=Math.min(a,l,1),s=e.width/2*n,o=e.height/2*n,i=(297-s)/2;console.log("[v0] Timetable: ".concat(e.width,"x").concat(e.height," -> ").concat(s.toFixed(1),"x").concat(o.toFixed(1)," mm")),t.addImage(r,"PNG",i,25,s,o),console.log("[v0] Main timetable added to PDF")}else console.warn("[v0] exportRef.current is null");if(X.current){console.log("[v0] Rasterizing summary..."),t.addPage();let e=await N(X.current),r=e.toDataURL("image/png"),a=267/(e.width/2),l=170/(e.height/2),n=Math.min(a,l,1),s=e.width/2*n,o=e.height/2*n,i=(297-s)/2;console.log("[v0] Summary: ".concat(e.width,"x").concat(e.height," -> ").concat(s.toFixed(1),"x").concat(o.toFixed(1)," mm")),t.addImage(r,"PNG",i,20,s,o),console.log("[v0] Summary added to PDF")}else console.warn("[v0] summaryRef.current is null");console.log("[v0] Saving PDF as:","".concat(e,".pdf")),t.save("".concat(e,".pdf")),console.log("[v0] PDF export completed successfully")}catch(t){console.error("[v0] Erreur export PDF:",t);let e=t instanceof Error?t.message:String(t);alert("Erreur lors de l'export PDF: ".concat(e))}finally{U(!1)}}if(1===e)return(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 to-amber-50 p-6",children:(0,l.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,l.jsxs)("div",{className:"text-center mb-8",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-gray-800 mb-2",children:"\uD83D\uDCDA G\xe9n\xe9rateur d'Emploi du Temps"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Configuration des horaires scolaires"})]}),(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-center",children:"S\xe9lection de la classe"}),(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsxs)("select",{value:r,onChange:e=>a(e.target.value),className:"p-3 rounded-lg border-2 border-gray-300 focus:border-cyan-500 text-lg min-w-[200px]",children:[(0,l.jsx)("option",{value:"CP",children:"CP (Cycle 2)"}),(0,l.jsx)("option",{value:"CE1",children:"CE1 (Cycle 2)"}),(0,l.jsx)("option",{value:"CE2",children:"CE2 (Cycle 2)"}),(0,l.jsx)("option",{value:"CM1",children:"CM1 (Cycle 3)"}),(0,l.jsx)("option",{value:"CM2",children:"CM2 (Cycle 3)"})]})}),(0,l.jsx)("div",{className:"flex justify-center mt-4",children:(0,l.jsx)("button",{onClick:()=>{try{z(JSON.parse(JSON.stringify(ee)))}catch(e){z(ee.map(e=>({...e})))}A(!0)},className:"px-4 py-2 rounded-lg bg-amber-500 hover:bg-amber-600 text-white transition-colors",children:"Personnaliser mati\xe8res"})})]}),f&&(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold",children:"Personnaliser mati\xe8res & volumes"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("button",{onClick:()=>z(D[$].map(e=>({...e}))),className:"px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-800",children:["R\xe9initialiser ",$]}),(0,l.jsx)("button",{onClick:()=>z(e=>[...e,{key:"autre_".concat(e.length+1),label:"Nouvelle mati\xe8re",minutes:60}]),className:"px-3 py-2 rounded-lg bg-amber-100 hover:bg-amber-200 text-amber-900",children:"Ajouter une mati\xe8re"}),(0,l.jsx)("button",{onClick:()=>{let e=R.map(e=>({...e,label:(e.label||"").trim(),key:(e.key||"").trim(),minutes:Math.max(0,Number(e.minutes||0))}));if(e.some(e=>!e.label||!e.key)){alert("Chaque mati\xe8re doit avoir un libell\xe9 et une cl\xe9 non vides.");return}let t=new Set;for(let r of e){if(t.has(r.key)){alert("Cl\xe9 de mati\xe8re en double: ".concat(r.key));return}t.add(r.key)}x(e),A(!1)},className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white",children:"Appliquer"})]})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"text-left text-gray-600",children:[(0,l.jsx)("th",{className:"py-2 pr-2 w-8"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Libell\xe9"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Cl\xe9"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Heures"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Minutes"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Total"})]})}),(0,l.jsx)("tbody",{children:R.map((e,t)=>{let r=Math.floor((e.minutes||0)/60),a=(e.minutes||0)%60;return(0,l.jsxs)("tr",{className:"border-t",children:[(0,l.jsx)("td",{className:"py-2 pr-2 w-8",children:(0,l.jsx)("button",{onClick:()=>{let e=[...R];e.splice(t,1),z(e)},className:"w-6 h-6 rounded-full bg-red-100 text-red-600 hover:bg-red-200 flex items-center justify-center",title:"Supprimer","aria-label":"Supprimer la mati\xe8re",children:"-"})}),(0,l.jsx)("td",{className:"py-2 pr-4",children:(0,l.jsx)("input",{value:e.label,onChange:e=>{let r=[...R];r[t]={...r[t],label:e.target.value},z(r)},className:"w-full p-2 border rounded-lg"})}),(0,l.jsx)("td",{className:"py-2 pr-4",children:(0,l.jsx)("input",{value:e.key,onChange:e=>{let r=[...R];r[t]={...r[t],key:e.target.value},z(r)},className:"w-full p-2 border rounded-lg"})}),(0,l.jsx)("td",{className:"py-2 pr-4 w-28",children:(0,l.jsx)("input",{type:"number",min:0,value:r,onChange:e=>{let r=Math.max(0,parseInt(e.target.value||"0",10)),a=[...R],l=60*r+(a[t].minutes||0)%60;a[t]={...a[t],minutes:l},z(a)},className:"w-full p-2 border rounded-lg"})}),(0,l.jsx)("td",{className:"py-2 pr-4 w-28",children:(0,l.jsx)("input",{type:"number",min:0,max:59,value:a,onChange:e=>{let r=Math.max(0,Math.min(59,parseInt(e.target.value||"0",10))),a=[...R],l=60*Math.floor((a[t].minutes||0)/60)+r;a[t]={...a[t],minutes:l},z(a)},className:"w-full p-2 border rounded-lg"})}),(0,l.jsx)("td",{className:"py-2 pr-4 text-gray-700",children:v(e.minutes||0)})]},t)})})]})})]}),(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-6 text-center",children:"Configuration des jours d'\xe9cole"}),(0,l.jsx)("div",{className:"space-y-6",children:s.map((e,t)=>(0,l.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,l.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,l.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:e=>{let r=[...s];r[t].enabled=e.target.checked,o(r)},className:"w-5 h-5 text-cyan-600"}),(0,l.jsx)("span",{className:"text-xl font-medium",children:e.label})]})}),e.enabled&&(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"D\xe9but matin"}),(0,l.jsx)("input",{type:"time",value:e.morningStart,onChange:e=>{let r=[...s];r[t].morningStart=e.target.value,o(r)},className:"w-full p-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Fin journ\xe9e"}),(0,l.jsx)("input",{type:"time",value:e.dayEnd,onChange:e=>{let r=[...s];r[t].dayEnd=e.target.value,o(r)},className:"w-full p-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"D\xe9but cantine"}),(0,l.jsx)("input",{type:"time",value:e.lunchStart,onChange:e=>{let r=[...s];r[t].lunchStart=e.target.value,o(r)},className:"w-full p-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Fin cantine"}),(0,l.jsx)("input",{type:"time",value:e.lunchEnd,onChange:e=>{let r=[...s];r[t].lunchEnd=e.target.value,o(r)},className:"w-full p-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"R\xe9cr\xe9ation 1"}),(0,l.jsx)("input",{type:"time",value:e.rec1Start,onChange:e=>{let r=[...s];r[t].rec1Start=e.target.value,o(r)},className:"w-full p-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Dur\xe9e r\xe9cr\xe9 1 (min)"}),(0,l.jsx)("input",{type:"number",value:e.rec1Dur,onChange:e=>{let r=[...s];r[t].rec1Dur=Number.parseInt(e.target.value),o(r)},className:"w-full p-2 border rounded-lg",min:"5",max:"30"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"R\xe9cr\xe9ation 2"}),(0,l.jsx)("input",{type:"time",value:e.rec2Start,onChange:e=>{let r=[...s];r[t].rec2Start=e.target.value,o(r)},className:"w-full p-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Dur\xe9e r\xe9cr\xe9 2 (min)"}),(0,l.jsx)("input",{type:"number",value:e.rec2Dur,onChange:e=>{let r=[...s];r[t].rec2Dur=Number.parseInt(e.target.value),o(r)},className:"w-full p-2 border rounded-lg",min:"5",max:"30"})]})]})]},t))})]}),(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)("button",{onClick:()=>t(2),className:"px-8 py-4 rounded-lg bg-gradient-to-r from-cyan-500 to-amber-500 text-white font-semibold hover:from-cyan-600 hover:to-amber-600 transition-all transform hover:scale-105 shadow-lg",children:"Cr\xe9er l'emploi du temps →"})})]})});if(2===e){var ew;return(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 to-amber-50 p-4",children:[(0,l.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-4 mb-8 p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-cyan-200",children:[(0,l.jsxs)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-cyan-600 to-amber-600 bg-clip-text text-transparent",children:["\uD83D\uDCC5 Emploi du temps - ",r]}),(0,l.jsx)("button",{onClick:function(){confirm("Vider compl\xe8tement l'emploi du temps ?")&&u([])},disabled:L,className:"px-4 py-2 rounded-xl bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50",children:"\uD83D\uDDD1️ Vider tout"}),(0,l.jsx)("button",{onClick:eN,disabled:L,className:"px-4 py-2 rounded-xl bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50",children:L?"⏳ G\xe9n\xe9ration...":"✨ Compl\xe9ter auto"}),(0,l.jsx)("button",{onClick:ej,disabled:L,className:"px-4 py-2 rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 text-white font-semibold hover:from-purple-600 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50",children:L?"⏳ G\xe9n\xe9ration...":"\uD83E\uDD16 Remplir auto"}),(0,l.jsx)("button",{onClick:()=>{try{z(JSON.parse(JSON.stringify(ee)))}catch(e){z(ee.map(e=>({...e})))}A(!0)},className:"px-4 py-2 rounded-xl bg-amber-500 hover:bg-amber-600 text-white font-semibold transition-colors shadow-lg",children:"\uD83C\uDF9B️ Personnaliser mati\xe8res"}),(0,l.jsx)("button",{onClick:()=>Y(!0),disabled:V,className:"px-4 py-2 rounded-xl bg-gradient-to-r from-cyan-500 to-cyan-600 text-white font-semibold hover:from-cyan-600 hover:to-cyan-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50",children:V?"\uD83D\uDCBE Sauvegarde...":"\uD83D\uDCBE Sauvegarder"}),(0,l.jsx)("button",{onClick:()=>t(3),className:"px-6 py-2 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:"\uD83D\uDCCA Exporter PDF"})]}),f&&(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold",children:"Personnaliser mati\xe8res & volumes"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("button",{onClick:()=>z(D[$].map(e=>({...e}))),className:"px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-800",children:["R\xe9initialiser ",$]}),(0,l.jsx)("button",{onClick:()=>z(e=>[...e,{key:"autre_".concat(e.length+1),label:"Nouvelle mati\xe8re",minutes:60}]),className:"px-3 py-2 rounded-lg bg-amber-100 hover:bg-amber-200 text-amber-900",children:"Ajouter une mati\xe8re"}),(0,l.jsx)("button",{onClick:()=>{let e=R.map(e=>({...e,label:(e.label||"").trim(),key:(e.key||"").trim(),minutes:Math.max(0,Number(e.minutes||0))}));if(e.some(e=>!e.label||!e.key)){alert("Chaque mati\xe8re doit avoir un libell\xe9 et une cl\xe9 non vides.");return}let t=new Set;for(let r of e){if(t.has(r.key)){alert("Cl\xe9 de mati\xe8re en double: ".concat(r.key));return}t.add(r.key)}x(e),A(!1)},className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white",children:"Appliquer"})]})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"text-left text-gray-600",children:[(0,l.jsx)("th",{className:"py-2 pr-2 w-8"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Libell\xe9"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Cl\xe9"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Heures"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Minutes"}),(0,l.jsx)("th",{className:"py-2 pr-4",children:"Total"})]})}),(0,l.jsx)("tbody",{children:R.map((e,t)=>{let r=Math.floor((e.minutes||0)/60),a=(e.minutes||0)%60;return(0,l.jsxs)("tr",{className:"border-t",children:[(0,l.jsx)("td",{className:"py-2 pr-2 w-8",children:(0,l.jsx)("button",{onClick:()=>{let e=[...R];e.splice(t,1),z(e)},className:"w-6 h-6 rounded-full bg-red-100 text-red-600 hover:bg-red-200 flex items-center justify-center",title:"Supprimer","aria-label":"Supprimer la mati\xe8re",children:"-"})}),(0,l.jsx)("td",{className:"py-2 pr-4",children:(0,l.jsx)("input",{value:e.label,onChange:e=>{let r=[...R];r[t]={...r[t],label:e.target.value},z(r)},className:"w-full p-2 border rounded-lg"})}),(0,l.jsx)("td",{className:"py-2 pr-4",children:(0,l.jsx)("input",{value:e.key,onChange:e=>{let r=[...R];r[t]={...r[t],key:e.target.value},z(r)},className:"w-full p-2 border rounded-lg"})}),(0,l.jsx)("td",{className:"py-2 pr-4 w-28",children:(0,l.jsx)("input",{type:"number",min:0,value:r,onChange:e=>{let r=Math.max(0,parseInt(e.target.value||"0",10)),a=[...R],l=60*r+(a[t].minutes||0)%60;a[t]={...a[t],minutes:l},z(a)},className:"w-full p-2 border rounded-lg"})}),(0,l.jsx)("td",{className:"py-2 pr-4 w-28",children:(0,l.jsx)("input",{type:"number",min:0,max:59,value:a,onChange:e=>{let r=Math.max(0,Math.min(59,parseInt(e.target.value||"0",10))),a=[...R],l=60*Math.floor((a[t].minutes||0)/60)+r;a[t]={...a[t],minutes:l},z(a)},className:"w-full p-2 border rounded-lg"})}),(0,l.jsx)("td",{className:"py-2 pr-4 text-gray-700",children:v(e.minutes||0)})]},t)})})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,l.jsx)("div",{className:"lg:col-span-1",children:(0,l.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-cyan-200 p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-800",children:"\uD83D\uDCDA Mati\xe8res disponibles"}),(0,l.jsx)("div",{className:"space-y-3",children:ee.map(e=>{let t=en[e.key]||0,r=el[e.key]||0,a=ea[e.key]||0,n=T[e.key]||T.autre;return(0,l.jsxs)("div",{draggable:!0,onDragStart:t=>{t.dataTransfer.setData("text/plain",e.key)},className:"".concat(n," border-2 rounded-xl p-3 cursor-grab active:cursor-grabbing hover:shadow-md transition-all duration-200"),children:[(0,l.jsx)("div",{className:"font-medium text-sm text-gray-900",children:e.label}),(0,l.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:[v(r)," / ",v(a)]}),t>0&&(0,l.jsxs)("div",{className:"text-xs text-red-600 font-medium",children:["Reste: ",v(t)]})]},e.key)})}),(0,l.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-3 text-gray-800",children:"\uD83D\uDCCA Suivi des volumes"}),(0,l.jsx)("div",{className:"space-y-2",children:ee.map(e=>{let t=e.minutes,r=Math.min(100,Math.round(d.filter(t=>t.subject===e.key).reduce((e,t)=>e+(k(t.end)-k(t.start)),0)/t*100)),a=T[e.key]||T.autre;return(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,l.jsx)("span",{className:"font-medium",children:e.label}),(0,l.jsxs)("span",{children:[r,"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,l.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat(a.replace("bg-","bg-").replace("-100","-400")),style:{width:"".concat(r,"%")}})})]},e.key)})})]})]})}),(0,l.jsx)("div",{className:"lg:col-span-3",children:(0,l.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-cyan-200 p-6",children:(0,l.jsx)("div",{className:"grid gap-6",style:{gridTemplateColumns:"repeat(".concat(er.length,", 1fr)")},children:er.map(e=>{let t=et[e.key],r=k(t.morningStart),a=k(t.dayEnd),n=(a-r)*2,s=d.filter(t=>t.day===e.key);return(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("h3",{className:"text-lg font-bold text-center mb-4 text-gray-800 bg-gradient-to-r from-cyan-100 to-amber-100 rounded-lg py-2",children:e.label}),(0,l.jsxs)("div",{className:"relative bg-gray-50 rounded-lg border-2 border-gray-200 overflow-hidden",style:{height:"".concat(n,"px"),minHeight:"400px"},onDragOver:e=>e.preventDefault(),onDrop:t=>{t.preventDefault();let a=t.dataTransfer.getData("text/plain");if(!a)return;let l=t.currentTarget.getBoundingClientRect(),n=r+5*Math.round((t.clientY-l.top)/2/5),s={day:e.key,subject:a,start:w(n),end:w(n+60),subtitle:""};(function(e){let t=eb(e);if(t){let r=k(e.end)-k(e.start),a=ey(e.day,k(e.start),r);if(null===a)return alert("Impossible de placer le bloc: ".concat(t)),!1;{let t={...e,start:w(a),end:w(a+r)};return u(e=>{var r,a;return[...e,{...t,subtitle:t.subtitle||"",id:(null===(a=globalThis.crypto)||void 0===a?void 0:null===(r=a.randomUUID)||void 0===r?void 0:r.call(a))||"".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2))}]}),!0}}return u(t=>{var r,a;return[...t,{...e,subtitle:e.subtitle||"",id:(null===(a=globalThis.crypto)||void 0===a?void 0:null===(r=a.randomUUID)||void 0===r?void 0:r.call(a))||"".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2))}]}),!0})(s)&&console.log("[v0] Block added successfully: ".concat(a," ").concat(s.start,"-").concat(s.end))},children:[Array.from({length:Math.ceil((a-r)/60)+1},(e,t)=>{let a=r+60*t,n=(a-r)*2;return(0,l.jsx)("div",{className:"absolute left-0 right-0 border-t border-gray-300 flex items-center",style:{top:"".concat(n,"px")},children:(0,l.jsx)("span",{className:"text-xs text-gray-500 bg-white px-1 rounded",children:w(a)})},t)}),ex(t).map((e,t)=>{let[a,n]=e,s=(a-r)*2;return(0,l.jsxs)("div",{className:"absolute left-0 right-0 bg-yellow-200 border border-yellow-400 flex items-center justify-center text-xs font-medium text-yellow-800",style:{top:"".concat(s,"px"),height:"".concat((n-a)*2,"px")},children:["\uD83C\uDFC3 R\xe9cr\xe9 ",t+1]},t)}),(()=>{let e=k(t.lunchStart),a=k(t.lunchEnd),n=(e-r)*2;return(0,l.jsx)("div",{className:"absolute left-0 right-0 bg-orange-200 border border-orange-400 flex items-center justify-center text-xs font-medium text-orange-800",style:{top:"".concat(n,"px"),height:"".concat((a-e)*2,"px")},children:"\uD83C\uDF7D️ Cantine"})})(),s.map(e=>(0,l.jsx)(ev,{block:e,zoneStart:r,zoneEnd:a},e.id)),(0,l.jsx)("div",{className:"absolute left-0 right-0 border-t-2 border-gray-400",style:{top:"".concat(n,"px")}})]})]},e.key)})})})})]})]}),G.length>0&&(0,l.jsxs)("div",{className:"max-w-7xl mx-auto mt-8 p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-cyan-200",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold mb-4 text-gray-800",children:"\uD83D\uDCC1 Emplois du temps sauvegard\xe9s"}),(0,l.jsx)("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:G.map(e=>(0,l.jsxs)("div",{className:"p-4 bg-white rounded-lg border border-gray-200 shadow-sm",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-800 truncate",children:e.name}),(0,l.jsx)("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:e.class_name})]}),(0,l.jsx)("div",{className:"text-xs text-gray-500 mb-3",children:new Date(e.created_at||"").toLocaleDateString("fr-FR")}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>eu(e),className:"flex-1 px-3 py-2 bg-green-500 text-white text-sm rounded-lg hover:bg-green-600 transition-colors",children:"\uD83D\uDCC2 Charger"}),(0,l.jsx)("button",{onClick:()=>em(e.id,e.name),className:"px-3 py-2 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600 transition-colors",children:"\uD83D\uDDD1️"})]})]},e.id))})]}),Q&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 max-w-md w-full mx-4",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Sauvegarder l'emploi du temps"}),(0,l.jsx)("input",{type:"text",value:W,onChange:e=>Z(e.target.value),placeholder:"Nom de la sauvegarde (ex: EDT CM1 Janvier)",className:"w-full p-3 border border-gray-300 rounded-lg mb-4",onKeyDown:e=>"Enter"===e.key&&ed()}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{onClick:()=>{Y(!1),Z("")},className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Annuler"}),(0,l.jsx)("button",{onClick:ed,disabled:V||!W.trim(),className:"flex-1 px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors disabled:opacity-50",children:V?"Sauvegarde...":"Sauvegarder"})]})]})}),_&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"✏️ \xc9diter le cr\xe9neau"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mati\xe8re"}),(0,l.jsx)("div",{className:"p-3 bg-gray-100 rounded-lg text-gray-800 font-medium",children:(null===(ew=ee.find(e=>e.key===_.subject))||void 0===ew?void 0:ew.label)||_.subject})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sous-titre (optionnel)"}),(0,l.jsx)("input",{type:"text",value:_.subtitle||"",onChange:e=>F({..._,subtitle:e.target.value}),placeholder:"Ex: Grammaire, G\xe9om\xe9trie, Lecture...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"})]})]}),(0,l.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,l.jsx)("button",{onClick:()=>F(null),className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Annuler"}),(0,l.jsx)("button",{onClick:()=>{eg(_.id,{subtitle:_.subtitle}),F(null)},className:"flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:"Sauvegarder"})]})]})})]})}if(3===e){let e=I.find(e=>e.key===O)||I[0];return(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[(0,l.jsxs)("div",{className:"flex items-center justify-center mb-8",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold mr-4",children:"\uD83D\uDCC4 Export PDF"}),(0,l.jsx)("button",{onClick:()=>t(2),className:"p-4 rounded-lg bg-blue-500 text-white font-semibold hover:bg-blue-600 transition-colors mr-4",children:"← Retour"}),(0,l.jsx)("button",{onClick:ek,className:"p-4 rounded-lg bg-green-500 text-white font-semibold hover:bg-green-600 transition-colors",children:L?"⏳ Export...":"\uD83D\uDCE5 T\xe9l\xe9charger PDF"})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center mb-8",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Titre de l'emploi du temps"}),(0,l.jsx)("input",{type:"text",value:J,onChange:e=>q(e.target.value),className:"p-2 rounded-lg border-2 w-full",placeholder:"Ex: Emploi du temps CM1 - 2024/2025"})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center mb-8",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Template"}),I.map(e=>(0,l.jsx)("button",{onClick:()=>P(e.key),className:"p-2 rounded-lg mb-2 ".concat(O===e.key?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-600 transition-colors"),children:e.name},e.key))]}),(0,l.jsxs)("div",{className:"flex flex-col items-center mb-8",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Aper\xe7u"}),(0,l.jsxs)("div",{ref:B,className:"rounded-2xl border ".concat(e.card," ").concat(e.gridBg," p-6 bg-white shadow-lg"),style:{width:"1400px",minHeight:"600px"},children:[(0,l.jsxs)("div",{className:"px-6 py-4 rounded-xl bg-blue-500 text-white mb-4 text-center",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold",children:J||"Emploi du temps - ".concat(r)}),(0,l.jsxs)("h2",{className:"text-lg font-medium",children:["Classe de ",r," (Cycle ",$,")"]})]}),(0,l.jsxs)("div",{className:"grid gap-2",style:{gridTemplateColumns:"repeat(".concat(er.length,", 1fr)")},children:[er.map(e=>(0,l.jsx)("div",{className:"text-center py-2 px-1 bg-cyan-100 rounded-lg font-semibold text-gray-800",children:e.label},"header-".concat(e.key))),er.map(e=>{let t=et[e.key],r=k(t.morningStart),a=k(t.dayEnd),n=d.filter(t=>t.day===e.key);return(0,l.jsxs)("div",{className:"relative bg-gray-50 rounded-lg border",style:{height:"".concat(Math.max((a-r)*1.8,400),"px"),minHeight:"400px"},children:[Array.from({length:Math.ceil((a-r)/60)+1},(e,t)=>{let a=r+60*t,n=(a-r)*1.8;return(0,l.jsx)("div",{className:"absolute left-0 right-0 border-t border-gray-300 flex items-center",style:{top:"".concat(n,"px")},children:(0,l.jsx)("span",{className:"text-xs text-gray-500 bg-white px-1 rounded",style:{fontSize:"12px"},children:w(a)})},t)}),ex(t).map((e,t)=>{let[a,n]=e;return(0,l.jsxs)("div",{className:"absolute left-0 right-0 bg-yellow-200 border border-yellow-400 flex items-center justify-center text-xs font-medium text-yellow-800",style:{top:"".concat((a-r)*1.8,"px"),height:"".concat((n-a)*1.8,"px"),fontSize:"12px"},children:["\uD83C\uDFC3 R\xe9cr\xe9 ",t+1]},t)}),(()=>{let e=k(t.lunchStart||"12:00"),n=k(t.lunchEnd||"13:00");return e>=r&&n<=a?(0,l.jsx)("div",{className:"absolute left-0 right-0 bg-orange-200 border border-orange-400 flex items-center justify-center text-xs font-medium text-orange-800",style:{top:"".concat((e-r)*1.8,"px"),height:"".concat((n-e)*1.8,"px"),fontSize:"12px"},children:"\uD83C\uDF7D️ Cantine"}):null})(),n.map(e=>{var t;let a=k(e.start),n=k(e.end),s=T[e.subject]||T.autre,o=(null===(t=ee.find(t=>t.key===e.subject))||void 0===t?void 0:t.label)||e.subject;return(0,l.jsxs)("div",{className:"absolute left-1 right-1 ".concat(s," border-2 rounded-lg p-2 flex flex-col justify-center text-center"),style:{top:"".concat((a-r)*1.8,"px"),height:"".concat((n-a)*1.8,"px"),overflow:"visible",wordWrap:"break-word",whiteSpace:"normal"},children:[(0,l.jsx)("div",{className:"font-medium text-gray-900",style:{fontSize:"14px",lineHeight:"1.2",marginBottom:"4px"},children:o}),e.subtitle&&(0,l.jsx)("div",{className:"text-gray-700",style:{fontSize:"11px",lineHeight:"1.1",marginBottom:"6px"},children:e.subtitle}),(0,l.jsxs)("div",{className:"text-gray-600",style:{fontSize:"12px",lineHeight:"1.1"},children:[e.start," - ",e.end]})]},e.id)})]},e.key)})]})]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center mb-8",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"R\xe9capitulatif des volumes horaires"}),(0,l.jsxs)("div",{ref:X,className:"rounded-2xl border ".concat(e.card," ").concat(e.gridBg," p-6 bg-white shadow-lg max-w-2xl"),children:[(0,l.jsxs)("div",{className:"px-4 py-3 rounded-xl ".concat(e.header," mb-4 text-center"),children:[(0,l.jsx)("h1",{className:"text-xl font-bold",children:"Volumes hebdomadaires (sans r\xe9cr\xe9)"}),(0,l.jsxs)("h2",{className:"text-sm font-medium",children:["Classe de ",r," (Cycle ",$,")"]})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("th",{className:"text-left py-2 px-3",children:"Mati\xe8re"}),(0,l.jsx)("th",{className:"text-center py-2 px-3",children:"Requis"}),(0,l.jsx)("th",{className:"text-center py-2 px-3",children:"Planifi\xe9"}),(0,l.jsx)("th",{className:"text-center py-2 px-3",children:"Restant"}),(0,l.jsx)("th",{className:"text-center py-2 px-3",children:"%"})]})}),(0,l.jsx)("tbody",{children:ee.map(e=>{let t=el[e.key]||0,r=ea[e.key]||0,a=Math.max(0,r-t),n=r>0?Math.round(t/r*100):0,s=T[e.key]||T.autre;return(0,l.jsxs)("tr",{className:"border-b ".concat(s.replace("border-","bg-").replace("-300","-50")),children:[(0,l.jsx)("td",{className:"py-2 px-3 font-medium",children:e.label}),(0,l.jsx)("td",{className:"py-2 px-3 text-center",children:v(r)}),(0,l.jsx)("td",{className:"py-2 px-3 text-center",children:v(t)}),(0,l.jsx)("td",{className:"py-2 px-3 text-center ".concat(0===a?"text-green-700":a>0?"text-amber-700":"text-red-700"),children:v(a)}),(0,l.jsxs)("td",{className:"py-2 px-3 text-center font-medium ".concat(n>=100?"text-green-700":n>=80?"text-amber-700":"text-red-700"),children:[n,"%"]})]},e.key)})})]})})]})]})]})}return null}},9967:(e,t,r)=>{Promise.resolve().then(r.bind(r,7804))}},e=>{var t=t=>e(e.s=t);e.O(0,[803,930,316,746,441,684,358],()=>t(9967)),_N_E=e.O()}]);