"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{3736:(e,t,r)=>{r.d(t,{pY:()=>tF});var a,o,n,s,i,l,u,p,c,d,m,h,f,g,y,v=r(9613),b=r(9143),z=r(5102),w=r(9723),I=r(9889),E=r(1053),T=Object.defineProperty,x="AI_NoOutputSpecifiedError",S=`vercel.ai.error.${x}`,j=Symbol.for(S),_=class extends b.bD{constructor({message:e="No output specified."}={}){super({name:x,message:e}),this[a]=!0}static isInstance(e){return b.bD.hasMarker(e,S)}};a=j;var R="AI_InvalidArgumentError",O=`vercel.ai.error.${R}`,A=Symbol.for(O),N=class extends b.bD{constructor({parameter:e,value:t,message:r}){super({name:R,message:`Invalid argument for parameter ${e}: ${r}`}),this[o]=!0,this.parameter=e,this.value=t}static isInstance(e){return b.bD.hasMarker(e,O)}};o=A;var k=Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");b.bD;var C="AI_InvalidToolInputError",M=`vercel.ai.error.${C}`,D=Symbol.for(M),P=class extends b.bD{constructor({toolInput:e,toolName:t,cause:r,message:a=`Invalid input for tool ${t}: ${(0,b.u1)(r)}`}){super({name:C,message:a,cause:r}),this[n]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return b.bD.hasMarker(e,M)}};n=D;var $="vercel.ai.error.AI_MCPClientError",U=Symbol.for($),F=class extends b.bD{constructor({name:e="MCPClientError",message:t,cause:r}){super({name:e,message:t,cause:r}),this[s]=!0}static isInstance(e){return b.bD.hasMarker(e,$)}};s=U;var J="AI_NoImageGeneratedError",B=`vercel.ai.error.${J}`,L=Symbol.for(B);b.bD,i=L;var q="AI_NoObjectGeneratedError",V=`vercel.ai.error.${q}`,Y=Symbol.for(V),G=class extends b.bD{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:o,finishReason:n}){super({name:q,message:e,cause:t}),this[l]=!0,this.text=r,this.response=a,this.usage=o,this.finishReason=n}static isInstance(e){return b.bD.hasMarker(e,V)}};l=Y;var K="AI_NoOutputGeneratedError",W=`vercel.ai.error.${K}`,Z=Symbol.for(W),H=class extends b.bD{constructor({message:e="No output generated.",cause:t}={}){super({name:K,message:e,cause:t}),this[u]=!0}static isInstance(e){return b.bD.hasMarker(e,W)}};u=Z;var Q="AI_NoSuchToolError",X=`vercel.ai.error.${Q}`,ee=Symbol.for(X),et=class extends b.bD{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:Q,message:r}),this[p]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return b.bD.hasMarker(e,X)}};p=ee;var er="AI_ToolCallRepairError",ea=`vercel.ai.error.${er}`,eo=Symbol.for(ea),en=class extends b.bD{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${(0,b.u1)(e)}`}){super({name:er,message:r,cause:e}),this[c]=!0,this.originalError=t}static isInstance(e){return b.bD.hasMarker(e,ea)}};c=eo;var es=class extends b.bD{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},ei="AI_InvalidDataContentError",el=`vercel.ai.error.${ei}`,eu=Symbol.for(el);b.bD,d=eu;var ep="AI_InvalidMessageRoleError",ec=`vercel.ai.error.${ep}`,ed=Symbol.for(ec),em=class extends b.bD{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:ep,message:t}),this[m]=!0,this.role=e}static isInstance(e){return b.bD.hasMarker(e,ec)}};m=ed;var eh="AI_MessageConversionError",ef=`vercel.ai.error.${eh}`,eg=Symbol.for(ef);b.bD,h=eg;var ey="AI_DownloadError",ev=`vercel.ai.error.${ey}`,eb=Symbol.for(ev),ez=class extends b.bD{constructor({url:e,statusCode:t,statusText:r,cause:a,message:o=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:ey,message:o,cause:a}),this[f]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return b.bD.hasMarker(e,ev)}};f=eb;var ew="AI_RetryError",eI=`vercel.ai.error.${ew}`,eE=Symbol.for(eI),eT=class extends b.bD{constructor({message:e,reason:t,errors:r}){super({name:ew,message:e}),this[g]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return b.bD.hasMarker(e,eI)}};function ex(e){if("string"!=typeof e){if("v2"!==e.specificationVersion)throw new es({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return eS().languageModel(e)}function eS(){var e;return null!=(e=globalThis.AI_SDK_DEFAULT_PROVIDER)?e:z.JS}g=eE;var ej=[{mediaType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mediaType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mediaType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mediaType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mediaType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],e_=e=>{let t="string"==typeof e?(0,v.Z9)(e):e,r=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(r+10)};async function eR({url:e}){var t;let r=e.toString();try{let e=await fetch(r);if(!e.ok)throw new ez({url:r,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(ez.isInstance(e))throw e;throw new ez({url:r,cause:e})}}var eO=w.z.union([w.z.string(),w.z.instanceof(Uint8Array),w.z.instanceof(ArrayBuffer),w.z.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function eA(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:r}=function(e){try{let[t,r]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==r)throw new b.bD({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:r,mediaType:t}}return{data:e,mediaType:void 0}}async function eN({prompt:e,supportedUrls:t,downloadImplementation:r=eR}){let a=await ek(e.messages,r,t);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function({message:e,downloadedAssets:t}){let r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"user",content:e.content.map(e=>(function(e,t){var r;let a;if("text"===e.type)return{type:"text",text:e.text,providerOptions:e.providerOptions};let o=e.type;switch(o){case"image":a=e.image;break;case"file":a=e.data;break;default:throw Error(`Unsupported part type: ${o}`)}let{data:n,mediaType:s}=eA(a),i=null!=s?s:e.mediaType,l=n;if(l instanceof URL){let e=t[l.toString()];e&&(l=e.data,null!=i||(i=e.mediaType))}switch(o){case"image":return(l instanceof Uint8Array||"string"==typeof l)&&(i=null!=(r=function({data:e,signatures:t}){let r="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?e_(e):e;for(let e of t)if("string"==typeof r?r.startsWith(e.base64Prefix):r.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>r[t]===e))return e.mediaType}({data:l,signatures:ej}))?r:i),{type:"file",mediaType:null!=i?i:"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":if(null==i)throw Error("Media type is missing for file part");return{type:"file",mediaType:i,filename:e.filename,data:l,providerOptions:e.providerOptions}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerOptions:e.providerOptions};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{let t=e.providerOptions;switch(e.type){case"file":{let{data:r,mediaType:a}=eA(e.data);return{type:"file",data:r,filename:e.filename,mediaType:null!=a?a:e.mediaType,providerOptions:t}}case"reasoning":return{type:"reasoning",text:e.text,providerOptions:t};case"text":return{type:"text",text:e.text,providerOptions:t};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:throw new em({role:r})}})({message:e,downloadedAssets:a}))]}async function ek(e,t,r){let a=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let r=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,a="image"===e.type?e.image:e.data;if("string"==typeof a)try{a=new URL(a)}catch(e){}return{mediaType:r,data:a}}).filter(e=>e.data instanceof URL&&null!=e.mediaType&&!(0,v.qs)({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:r})).map(e=>e.data);return Object.fromEntries((await Promise.all(a.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function eC({maxOutputTokens:e,temperature:t,topP:r,topK:a,presencePenalty:o,frequencyPenalty:n,seed:s,stopSequences:i}){if(null!=e){if(!Number.isInteger(e))throw new N({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new N({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new N({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new N({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new N({parameter:"topK",value:a,message:"topK must be a number"});if(null!=o&&"number"!=typeof o)throw new N({parameter:"presencePenalty",value:o,message:"presencePenalty must be a number"});if(null!=n&&"number"!=typeof n)throw new N({parameter:"frequencyPenalty",value:n,message:"frequencyPenalty must be a number"});if(null!=s&&!Number.isInteger(s))throw new N({parameter:"seed",value:s,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:r,topK:a,presencePenalty:o,frequencyPenalty:n,stopSequences:i,seed:s}}function eM({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"dynamic":case"function":return{type:"function",name:e,description:t.description,inputSchema:asSchema(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var eD=w.z.lazy(()=>w.z.union([w.z.null(),w.z.string(),w.z.number(),w.z.boolean(),w.z.record(w.z.string(),eD),w.z.array(eD)])),eP=w.z.record(w.z.string(),w.z.record(w.z.string(),eD)),e$=w.z.object({type:w.z.literal("text"),text:w.z.string(),providerOptions:eP.optional()}),eU=w.z.object({type:w.z.literal("image"),image:w.z.union([eO,w.z.instanceof(URL)]),mediaType:w.z.string().optional(),providerOptions:eP.optional()}),eF=w.z.object({type:w.z.literal("file"),data:w.z.union([eO,w.z.instanceof(URL)]),filename:w.z.string().optional(),mediaType:w.z.string(),providerOptions:eP.optional()}),eJ=w.z.object({type:w.z.literal("reasoning"),text:w.z.string(),providerOptions:eP.optional()}),eB=w.z.object({type:w.z.literal("tool-call"),toolCallId:w.z.string(),toolName:w.z.string(),input:w.z.unknown(),providerOptions:eP.optional(),providerExecuted:w.z.boolean().optional()}),eL=w.z.discriminatedUnion("type",[w.z.object({type:w.z.literal("text"),value:w.z.string()}),w.z.object({type:w.z.literal("json"),value:eD}),w.z.object({type:w.z.literal("error-text"),value:w.z.string()}),w.z.object({type:w.z.literal("error-json"),value:eD}),w.z.object({type:w.z.literal("content"),value:w.z.array(w.z.union([w.z.object({type:w.z.literal("text"),text:w.z.string()}),w.z.object({type:w.z.literal("media"),data:w.z.string(),mediaType:w.z.string()})]))})]),eq=w.z.object({type:w.z.literal("tool-result"),toolCallId:w.z.string(),toolName:w.z.string(),output:eL,providerOptions:eP.optional()}),eV=w.z.object({role:w.z.literal("system"),content:w.z.string(),providerOptions:eP.optional()}),eY=w.z.object({role:w.z.literal("user"),content:w.z.union([w.z.string(),w.z.array(w.z.union([e$,eU,eF]))]),providerOptions:eP.optional()}),eG=w.z.object({role:w.z.literal("assistant"),content:w.z.union([w.z.string(),w.z.array(w.z.union([e$,eF,eJ,eB,eq]))]),providerOptions:eP.optional()}),eK=w.z.object({role:w.z.literal("tool"),content:w.z.array(eq),providerOptions:eP.optional()}),eW=w.z.union([eV,eY,eG,eK]);async function eZ(e){let t;if(null==e.prompt&&null==e.messages)throw new b.M3({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new b.M3({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new b.M3({prompt:e,message:"system must be a string"});if(null!=e.prompt&&"string"==typeof e.prompt)t=[{role:"user",content:e.prompt}];else if(null!=e.prompt&&Array.isArray(e.prompt))t=e.prompt;else if(null!=e.messages)t=e.messages;else throw new b.M3({prompt:e,message:"prompt or messages must be defined"});if(0===t.length)throw new b.M3({prompt:e,message:"messages must not be empty"});let r=await (0,v.ZZ)({value:t,schema:w.z.array(eW)});if(!r.success)throw new b.M3({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:r.error});return{messages:t,system:e.system}}function eH(e){return z.jN.isInstance(e)||z.vj.isInstance(e)?new b.bD({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:e}):e}function eQ({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function eX({model:e,settings:t,telemetry:r,headers:a}){var o;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(o=null==r?void 0:r.metadata)?o:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}var e0={startSpan:()=>e1,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(e1):"function"==typeof r?r(e1):"function"==typeof a?a(e1):void 0},e1={spanContext:()=>e2,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},e2={traceId:"",spanId:"",traceFlags:0};function e8({isEnabled:e=!1,tracer:t}={}){return e?t||I.u.getTracer("ai"):e0}function e4({name:e,tracer:t,attributes:r,fn:a,endWhenDone:o=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return o&&e.end(),t}catch(t){try{e6(e,t)}finally{e.end()}throw t}})}function e6(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:E.s.ERROR,message:t.message})):e.setStatus({code:E.s.ERROR})}function e7({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(null==a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let o=a.input();return null==o?t:{...t,[r]:o}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let o=a.output();return null==o?t:{...t,[r]:o}}return{...t,[r]:a}},{})}function e3(e){return JSON.stringify(e.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(e=>{var t;return"file"===e.type?{...e,data:e.data instanceof Uint8Array?"string"==typeof(t=e.data)?t:t instanceof ArrayBuffer?(0,v.n_)(new Uint8Array(t)):(0,v.n_)(t):e.data}:e})})))}function e9(e,t){return{inputTokens:e5(e.inputTokens,t.inputTokens),outputTokens:e5(e.outputTokens,t.outputTokens),totalTokens:e5(e.totalTokens,t.totalTokens),reasoningTokens:e5(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:e5(e.cachedInputTokens,t.cachedInputTokens)}}function e5(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}function te(e){return void 0===e?[]:Array.isArray(e)?e:[e]}var tt=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2,abortSignal:a}={})=>async o=>tr(o,{maxRetries:e,delayInMs:t,backoffFactor:r,abortSignal:a});async function tr(e,{maxRetries:t,delayInMs:r,backoffFactor:a,abortSignal:o},n=[]){try{return await e()}catch(u){if((0,v.zf)(u)||0===t)throw u;let s=(0,v.u1)(u),i=[...n,u],l=i.length;if(l>t)throw new eT({message:`Failed after ${l} attempts. Last error: ${s}`,reason:"maxRetriesExceeded",errors:i});if(u instanceof Error&&b.hL.isInstance(u)&&!0===u.isRetryable&&l<=t)return await (0,v.cb)(function({error:e,exponentialBackoffDelay:t}){let r;let a=e.responseHeaders;if(!a)return t;let o=a["retry-after-ms"];if(o){let e=parseFloat(o);Number.isNaN(e)||(r=e)}let n=a["retry-after"];if(n&&void 0===r){let e=parseFloat(n);r=Number.isNaN(e)?Date.parse(n)-Date.now():1e3*e}return null!=r&&!Number.isNaN(r)&&0<=r&&(r<6e4||r<t)?r:t}({error:u,exponentialBackoffDelay:r}),{abortSignal:o}),tr(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a,abortSignal:o},i);if(1===l)throw u;throw new eT({message:`Failed after ${l} attempts with non-retryable error: '${s}'`,reason:"errorNotRetryable",errors:i})}}function ta({maxRetries:e,abortSignal:t}){if(null!=e){if(!Number.isInteger(e))throw new N({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new N({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let r=null!=e?e:2;return{maxRetries:r,retry:tt({maxRetries:r,abortSignal:t})}}function to(e){let t=e.filter(e=>"text"===e.type);if(0!==t.length)return t.map(e=>e.text).join("")}var tn=class{constructor({data:e,mediaType:t}){let r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,v.n_)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,v.Z9)(this.base64Data)),this.uint8ArrayData}},ts=class extends tn{constructor(e){super(e),this.type="file"}};async function ti({toolCall:e,tools:t,repairToolCall:r,system:a,messages:o}){try{if(null==t)throw new et({toolName:e.toolName});try{return await tl({toolCall:e,tools:t})}catch(s){if(null==r||!(et.isInstance(s)||P.isInstance(s)))throw s;let n=null;try{n=await r({toolCall:e,tools:t,inputSchema:({toolName:e})=>{let{inputSchema:r}=t[e];return asSchema2(r).jsonSchema},system:a,messages:o,error:s})}catch(e){throw new en({cause:e,originalError:s})}if(null==n)throw s;return await tl({toolCall:n,tools:t})}}catch(a){let t=await safeParseJSON({text:e.input}),r=t.success?t.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:r,dynamic:!0,invalid:!0,error:a}}}async function tl({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new et({toolName:e.toolName,availableTools:Object.keys(t)});let o=asSchema2(a.inputSchema),n=""===e.input.trim()?await safeValidateTypes2({value:{},schema:o}):await safeParseJSON({text:e.input,schema:o});if(!1===n.success)throw new P({toolName:r,toolInput:e.input,cause:n.error});return"dynamic"===a.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:n.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:r,input:n.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var tu=class{constructor({content:e,finishReason:t,usage:r,warnings:a,request:o,response:n,providerMetadata:s}){this.content=e,this.finishReason=t,this.usage=r,this.warnings=a,this.request=o,this.response=n,this.providerMetadata=s}get text(){return this.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>"reasoning"===e.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>"file"===e.type).map(e=>e.file)}get sources(){return this.content.filter(e=>"source"===e.type)}get toolCalls(){return this.content.filter(e=>"tool-call"===e.type)}get staticToolCalls(){return this.toolCalls.filter(e=>!1===e.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(e=>!0===e.dynamic)}get toolResults(){return this.content.filter(e=>"tool-result"===e.type)}get staticToolResults(){return this.toolResults.filter(e=>!1===e.dynamic)}get dynamicToolResults(){return this.toolResults.filter(e=>!0===e.dynamic)}};async function tp({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function tc({output:e,tool:t,errorMode:r}){return"text"===r?{type:"error-text",value:getErrorMessage4(e)}:"json"===r?{type:"error-json",value:td(e)}:(null==t?void 0:t.toModelOutput)?t.toModelOutput(e):"string"==typeof e?{type:"text",value:e}:{type:"json",value:td(e)}}function td(e){return void 0===e?null:e}function tm({content:e,tools:t}){let r=[],a=e.filter(e=>"source"!==e.type).filter(e=>("tool-result"!==e.type||e.providerExecuted)&&("tool-error"!==e.type||e.providerExecuted)).filter(e=>"text"!==e.type||e.text.length>0).map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,providerOptions:e.providerMetadata};case"reasoning":return{type:"reasoning",text:e.text,providerOptions:e.providerMetadata};case"file":return{type:"file",data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tc({tool:null==t?void 0:t[e.toolName],output:e.output,errorMode:"none"}),providerExecuted:!0,providerOptions:e.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tc({tool:null==t?void 0:t[e.toolName],output:e.error,errorMode:"json"}),providerOptions:e.providerMetadata}}});a.length>0&&r.push({role:"assistant",content:a});let o=e.filter(e=>"tool-result"===e.type||"tool-error"===e.type).filter(e=>!e.providerExecuted).map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tc({tool:null==t?void 0:t[e.toolName],output:"tool-result"===e.type?e.output:e.error,errorMode:"tool-error"===e.type?"text":"none"})}));return o.length>0&&r.push({role:"tool",content:o}),r}var th=(0,v.hK)({prefix:"aitxt",size:24});async function tf({toolCalls:e,tools:t,tracer:r,telemetry:a,messages:o,abortSignal:n,experimental_context:s}){return(await Promise.all(e.map(async({toolCallId:e,toolName:i,input:l})=>{let u=t[i];if((null==u?void 0:u.execute)!=null)return e4({name:"ai.toolCall",attributes:e7({telemetry:a,attributes:{...eQ({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":i,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(l)}}}),tracer:r,fn:async t=>{try{let r;for await(let t of executeTool({execute:u.execute.bind(u),input:l,options:{toolCallId:e,messages:o,abortSignal:n,experimental_context:s}}))"final"===t.type&&(r=t.output);try{t.setAttributes(e7({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return{type:"tool-result",toolCallId:e,toolName:i,input:l,output:r,dynamic:"dynamic"===u.type}}catch(r){return e6(t,r),{type:"tool-error",toolCallId:e,toolName:i,input:l,error:r,dynamic:"dynamic"===u.type}}}})}))).filter(e=>null!=e)}var tg=class{constructor(e){this.steps=e.steps,this.resolvedOutput=e.resolvedOutput}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get totalUsage(){return this.steps.reduce((e,t)=>e9(e,t.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0})}get experimental_output(){if(null==this.resolvedOutput)throw new _;return this.resolvedOutput}};function ty(e){let t=e.filter(e=>"tool-call"===e.type);if(0!==t.length)return t.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,input:e.input}))}function tv(e,t){let r=new Headers(null!=e?e:{});for(let[e,a]of Object.entries(t))r.has(e)||r.set(e,a);return r}function tb({status:e,statusText:t,headers:r,textStream:a}){return new Response(a.pipeThrough(new TextEncoderStream),{status:null!=e?e:200,statusText:t,headers:tv(r,{"content-type":"text/plain; charset=utf-8"})})}function tz({response:e,status:t,statusText:r,headers:a,stream:o}){e.writeHead(null!=t?t:200,r,a);let n=o.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await n.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}function tw({response:e,status:t,statusText:r,headers:a,textStream:o}){tz({response:e,status:t,statusText:r,headers:Object.fromEntries(tv(a,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:o.pipeThrough(new TextEncoderStream)})}var tI=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue("data: [DONE]\n\n")}})}},tE={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"},tT=w.z.union([w.z.strictObject({type:w.z.literal("text-start"),id:w.z.string(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.literal("text-delta"),id:w.z.string(),delta:w.z.string(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.literal("text-end"),id:w.z.string(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.literal("error"),errorText:w.z.string()}),w.z.strictObject({type:w.z.literal("tool-input-start"),toolCallId:w.z.string(),toolName:w.z.string(),providerExecuted:w.z.boolean().optional(),dynamic:w.z.boolean().optional()}),w.z.strictObject({type:w.z.literal("tool-input-delta"),toolCallId:w.z.string(),inputTextDelta:w.z.string()}),w.z.strictObject({type:w.z.literal("tool-input-available"),toolCallId:w.z.string(),toolName:w.z.string(),input:w.z.unknown(),providerExecuted:w.z.boolean().optional(),providerMetadata:eP.optional(),dynamic:w.z.boolean().optional()}),w.z.strictObject({type:w.z.literal("tool-input-error"),toolCallId:w.z.string(),toolName:w.z.string(),input:w.z.unknown(),providerExecuted:w.z.boolean().optional(),providerMetadata:eP.optional(),dynamic:w.z.boolean().optional(),errorText:w.z.string()}),w.z.strictObject({type:w.z.literal("tool-output-available"),toolCallId:w.z.string(),output:w.z.unknown(),providerExecuted:w.z.boolean().optional(),dynamic:w.z.boolean().optional(),preliminary:w.z.boolean().optional()}),w.z.strictObject({type:w.z.literal("tool-output-error"),toolCallId:w.z.string(),errorText:w.z.string(),providerExecuted:w.z.boolean().optional(),dynamic:w.z.boolean().optional()}),w.z.strictObject({type:w.z.literal("reasoning"),text:w.z.string(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.literal("reasoning-start"),id:w.z.string(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.literal("reasoning-delta"),id:w.z.string(),delta:w.z.string(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.literal("reasoning-end"),id:w.z.string(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.literal("reasoning-part-finish")}),w.z.strictObject({type:w.z.literal("source-url"),sourceId:w.z.string(),url:w.z.string(),title:w.z.string().optional(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.literal("source-document"),sourceId:w.z.string(),mediaType:w.z.string(),title:w.z.string(),filename:w.z.string().optional(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.literal("file"),url:w.z.string(),mediaType:w.z.string(),providerMetadata:eP.optional()}),w.z.strictObject({type:w.z.string().startsWith("data-"),id:w.z.string().optional(),data:w.z.unknown(),transient:w.z.boolean().optional()}),w.z.strictObject({type:w.z.literal("start-step")}),w.z.strictObject({type:w.z.literal("finish-step")}),w.z.strictObject({type:w.z.literal("start"),messageId:w.z.string().optional(),messageMetadata:w.z.unknown().optional()}),w.z.strictObject({type:w.z.literal("finish"),messageMetadata:w.z.unknown().optional()}),w.z.strictObject({type:w.z.literal("abort")}),w.z.strictObject({type:w.z.literal("message-metadata"),messageMetadata:w.z.unknown()})]);async function tx(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,v.N8)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,v.N8)({text:function(e){let t=["ROOT"],r=-1,a=null;function o(e,o,n){switch(e){case'"':r=o,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=o,a=o,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":r=o,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":r=o,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function s(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let i=0;i<e.length;i++){let l=e[i];switch(t[t.length-1]){case"ROOT":o(l,i,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=i,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(l,i,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(l,i);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=i;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=i}break;case"INSIDE_ARRAY_START":"]"===l?(r=i,t.pop()):(r=i,o(l,i,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=i,t.pop();break;default:r=i}break;case"INSIDE_ARRAY_AFTER_COMMA":o(l,i,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=i;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=i;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(l,i),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,i);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,i);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(l,i);break;default:t.pop()}break;case"INSIDE_LITERAL":{let o=e.substring(a,i+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?r=i:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(l,i):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(l,i))}}}let i=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}return i}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function tS(e){return e.type.startsWith("tool-")}function tj(e){return e.type.split("-").slice(1).join("-")}function t_(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let e=t.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},t}async function tR({stream:e,onError:t}){let r=e.getReader();try{for(;;){let{done:e}=await r.read();if(e)break}}catch(e){null==t||t(e)}finally{r.releaseLock()}}function tO(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}function tA(){let e=[],t=null,r=!1,a=tO(),o=()=>{r=!0,a.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()},n=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return a=tO(),await a.promise,n();try{let{value:a,done:o}=await e[0].read();o?(e.shift(),e.length>0?await n():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(r){null==t||t.error(r),e.shift(),o()}};return{stream:new ReadableStream({start(e){t=e},pull:n,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:o}}var tN=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||(this._promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this._promise}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&(null==(t=this._reject)||t.call(this,e))}};(0,v.hK)({prefix:"aitxt",size:24});var tk={type:"no-schema",jsonSchema:void 0,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async(e,t)=>void 0===e?{success:!1,error:new G({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e},createElementStream(){throw new b.b8({functionality:"element streams in no-schema mode"})}},tC=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async t=>(0,v.ZZ)({value:t,schema:e}),createElementStream(){throw new b.b8({functionality:"element streams in object mode"})}}),tM=e=>{let{$schema:t,...r}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1},async validatePartialResult({value:t,latestObject:r,isFirstDelta:a,isFinalDelta:o}){var n;if(!(0,b.k9)(t)||!(0,b.cj)(t.elements))return{success:!1,error:new b.iM({value:t,cause:"value must be an object that contains an array of elements"})};let s=t.elements,i=[];for(let t=0;t<s.length;t++){let r=s[t],a=await (0,v.ZZ)({value:r,schema:e});if(t!==s.length-1||o){if(!a.success)return a;i.push(a.value)}}let l=null!=(n=null==r?void 0:r.length)?n:0,u="";return a&&(u+="["),l>0&&(u+=","),u+=i.slice(l).map(e=>JSON.stringify(e)).join(","),o&&(u+="]"),{success:!0,value:{partial:i,textDelta:u}}},async validateFinalResult(t){if(!(0,b.k9)(t)||!(0,b.cj)(t.elements))return{success:!1,error:new b.iM({value:t,cause:"value must be an object that contains an array of elements"})};let r=t.elements;for(let t of r){let r=await (0,v.ZZ)({value:t,schema:e});if(!r.success)return r}return{success:!0,value:r}},createElementStream(e){let t=0;return t_(e.pipeThrough(new TransformStream({transform(e,r){switch(e.type){case"object":{let a=e.object;for(;t<a.length;t++)r.enqueue(a[t]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}}},tD=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},async validateFinalResult(t){if(!(0,b.k9)(t)||"string"!=typeof t.result)return{success:!1,error:new b.iM({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let r=t.result;return e.includes(r)?{success:!0,value:r}:{success:!1,error:new b.iM({value:t,cause:"value must be a string in the enum"})}},async validatePartialResult({value:t,textDelta:r}){if(!(0,b.k9)(t)||"string"!=typeof t.result)return{success:!1,error:new b.iM({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let a=t.result,o=e.filter(e=>e.startsWith(a));return 0===t.result.length||0===o.length?{success:!1,error:new b.iM({value:t,cause:"value must be a string in the enum"})}:{success:!0,value:{partial:o.length>1?a:o[0],textDelta:r}}},createElementStream(){throw new b.b8({functionality:"element streams in enum mode"})}});async function tP(e,t,r){let a=await (0,v.N8)({text:e});if(!a.success)throw new G({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let o=await t.validateFinalResult(a.value,{text:e,response:r.response,usage:r.usage});if(!o.success)throw new G({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return o.value}async function t$(e,t,r,a){try{return await tP(e,t,a)}catch(o){if(null!=r&&G.isInstance(o)&&(b.u6.isInstance(o.cause)||b.iM.isInstance(o.cause))){let n=await r({text:e,error:o.cause});if(null===n)throw o;return await tP(n,t,a)}throw o}}var tU=(0,v.hK)({prefix:"aiobj",size:24});async function tF(e){let{model:t,output:r="object",system:a,prompt:o,messages:n,maxRetries:s,abortSignal:i,headers:l,experimental_repairText:u,experimental_telemetry:p,providerOptions:c,_internal:{generateId:d=tU,currentDate:m=()=>new Date}={},...h}=e,f=ex(t),g="enum"in e?e.enum:void 0,{schema:y,schemaDescription:b,schemaName:z}="schema"in e?e:{};!function({output:e,schema:t,schemaName:r,schemaDescription:a,enumValues:o}){if(null!=e&&"object"!==e&&"array"!==e&&"enum"!==e&&"no-schema"!==e)throw new N({parameter:"output",value:e,message:"Invalid output type."});if("no-schema"===e){if(null!=t)throw new N({parameter:"schema",value:t,message:"Schema is not supported for no-schema output."});if(null!=a)throw new N({parameter:"schemaDescription",value:a,message:"Schema description is not supported for no-schema output."});if(null!=r)throw new N({parameter:"schemaName",value:r,message:"Schema name is not supported for no-schema output."});if(null!=o)throw new N({parameter:"enumValues",value:o,message:"Enum values are not supported for no-schema output."})}if("object"===e){if(null==t)throw new N({parameter:"schema",value:t,message:"Schema is required for object output."});if(null!=o)throw new N({parameter:"enumValues",value:o,message:"Enum values are not supported for object output."})}if("array"===e){if(null==t)throw new N({parameter:"schema",value:t,message:"Element schema is required for array output."});if(null!=o)throw new N({parameter:"enumValues",value:o,message:"Enum values are not supported for array output."})}if("enum"===e){if(null!=t)throw new N({parameter:"schema",value:t,message:"Schema is not supported for enum output."});if(null!=a)throw new N({parameter:"schemaDescription",value:a,message:"Schema description is not supported for enum output."});if(null!=r)throw new N({parameter:"schemaName",value:r,message:"Schema name is not supported for enum output."});if(null==o)throw new N({parameter:"enumValues",value:o,message:"Enum values are required for enum output."});for(let e of o)if("string"!=typeof e)throw new N({parameter:"enumValues",value:e,message:"Enum values must be strings."})}}({output:r,schema:y,schemaName:z,schemaDescription:b,enumValues:g});let{maxRetries:w,retry:I}=ta({maxRetries:s,abortSignal:i}),E=function({output:e,schema:t,enumValues:r}){switch(e){case"object":return tC((0,v.mD)(t));case"array":return tM((0,v.mD)(t));case"enum":return tD(r);case"no-schema":return tk;default:throw Error(`Unsupported output: ${e}`)}}({output:r,schema:y,enumValues:g}),T=eC(h),x=eX({model:f,telemetry:p,headers:l,settings:{...T,maxRetries:w}}),S=e8(p);try{return await e4({name:"ai.generateObject",attributes:e7({telemetry:p,attributes:{...eQ({operationId:"ai.generateObject",telemetry:p}),...x,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:o,messages:n})},"ai.schema":null!=E.jsonSchema?{input:()=>JSON.stringify(E.jsonSchema)}:void 0,"ai.schema.name":z,"ai.schema.description":b,"ai.settings.output":E.type}}),tracer:S,fn:async e=>{var t;let r,s,g,y,v,w,j,_;let R=await eZ({system:a,prompt:o,messages:n}),O=await eN({prompt:R,supportedUrls:await f.supportedUrls}),A=await I(()=>e4({name:"ai.generateObject.doGenerate",attributes:e7({telemetry:p,attributes:{...eQ({operationId:"ai.generateObject.doGenerate",telemetry:p}),...x,"ai.prompt.messages":{input:()=>e3(O)},"gen_ai.system":f.provider,"gen_ai.request.model":f.modelId,"gen_ai.request.frequency_penalty":T.frequencyPenalty,"gen_ai.request.max_tokens":T.maxOutputTokens,"gen_ai.request.presence_penalty":T.presencePenalty,"gen_ai.request.temperature":T.temperature,"gen_ai.request.top_k":T.topK,"gen_ai.request.top_p":T.topP}}),tracer:S,fn:async e=>{var t,r,a,o,n,s,u,g;let y=await f.doGenerate({responseFormat:{type:"json",schema:E.jsonSchema,name:z,description:b},...eC(h),prompt:O,providerOptions:c,abortSignal:i,headers:l}),v={id:null!=(r=null==(t=y.response)?void 0:t.id)?r:d(),timestamp:null!=(o=null==(a=y.response)?void 0:a.timestamp)?o:m(),modelId:null!=(s=null==(n=y.response)?void 0:n.modelId)?s:f.modelId,headers:null==(u=y.response)?void 0:u.headers,body:null==(g=y.response)?void 0:g.body},w=to(y.content),I=function(e){let t=e.filter(e=>"reasoning"===e.type);return 0===t.length?void 0:t.map(e=>e.text).join("\n")}(y.content);if(void 0===w)throw new G({message:"No object generated: the model did not return a response.",response:v,usage:y.usage,finishReason:y.finishReason});return e.setAttributes(e7({telemetry:p,attributes:{"ai.response.finishReason":y.finishReason,"ai.response.object":{output:()=>w},"ai.response.id":v.id,"ai.response.model":v.modelId,"ai.response.timestamp":v.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(y.providerMetadata),"ai.usage.promptTokens":y.usage.inputTokens,"ai.usage.completionTokens":y.usage.outputTokens,"gen_ai.response.finish_reasons":[y.finishReason],"gen_ai.response.id":v.id,"gen_ai.response.model":v.modelId,"gen_ai.usage.input_tokens":y.usage.inputTokens,"gen_ai.usage.output_tokens":y.usage.outputTokens}})),{...y,objectText:w,reasoning:I,responseData:v}}}));r=A.objectText,s=A.finishReason,g=A.usage,y=A.warnings,j=A.providerMetadata,w=null!=(t=A.request)?t:{},v=A.responseData,_=A.reasoning;let N=await t$(r,E,u,{response:v,usage:g,finishReason:s});return e.setAttributes(e7({telemetry:p,attributes:{"ai.response.finishReason":s,"ai.response.object":{output:()=>JSON.stringify(N)},"ai.response.providerMetadata":JSON.stringify(j),"ai.usage.promptTokens":g.inputTokens,"ai.usage.completionTokens":g.outputTokens}})),new tJ({object:N,reasoning:_,finishReason:s,usage:g,warnings:y,request:w,response:v,providerMetadata:j})}})}catch(e){throw eH(e)}}var tJ=class{constructor(e){this.object=e.object,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.providerMetadata=e.providerMetadata,this.response=e.response,this.request=e.request,this.reasoning=e.reasoning}toJsonResponse(e){var t;return new Response(JSON.stringify(this.object),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:tv(null==e?void 0:e.headers,{"content-type":"application/json; charset=utf-8"})})}};function tB(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if("object"!=typeof e&&"object"!=typeof t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!tB(e[r],t[r]))return!1;return!0}let r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(let o of r)if(!a.includes(o)||!tB(e[o],t[o]))return!1;return!0}(0,v.hK)({prefix:"aiobj",size:24}),b.bD,((e,t)=>{for(var r in t)T(e,r,{get:t[r],enumerable:!0})})({},{object:()=>tq,text:()=>tL});var tL=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:e})=>({partial:e}),parseOutput:async({text:e})=>e}),tq=({schema:e})=>{let t=(0,v.mD)(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:e}){let t=await tx(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},r){let a=await (0,v.N8)({text:e});if(!a.success)throw new G({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let o=await (0,v.ZZ)({value:a.value,schema:t});if(!o.success)throw new G({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return o.value}}},tV=({model:e,middleware:t,modelId:r,providerId:a})=>te(t).reverse().reduce((e,t)=>tY({model:e,middleware:t,modelId:r,providerId:a}),e),tY=({model:e,middleware:{transformParams:t,wrapGenerate:r,wrapStream:a,overrideProvider:o,overrideModelId:n,overrideSupportedUrls:s},modelId:i,providerId:l})=>{var u,p,c;async function d({params:r,type:a}){return t?await t({params:r,type:a,model:e}):r}return{specificationVersion:"v2",provider:null!=(u=null!=l?l:null==o?void 0:o({model:e}))?u:e.provider,modelId:null!=(p=null!=i?i:null==n?void 0:n({model:e}))?p:e.modelId,supportedUrls:null!=(c=null==s?void 0:s({model:e}))?c:e.supportedUrls,async doGenerate(t){let a=await d({params:t,type:"generate"}),o=async()=>e.doGenerate(a),n=async()=>e.doStream(a);return r?r({doGenerate:o,doStream:n,params:a,model:e}):o()},async doStream(t){let r=await d({params:t,type:"stream"}),o=async()=>e.doGenerate(r),n=async()=>e.doStream(r);return a?a({doGenerate:o,doStream:n,params:r,model:e}):n()}}},tG="AI_NoSuchProviderError",tK=`vercel.ai.error.${tG}`,tW=Symbol.for(tK),tZ=class extends b.eM{constructor({modelId:e,modelType:t,providerId:r,availableProviders:a,message:o=`No such provider: ${r} (available providers: ${a.join()})`}){super({errorName:tG,modelId:e,modelType:t,message:o}),this[y]=!0,this.providerId=r,this.availableProviders=a}static isInstance(e){return b.bD.hasMarker(e,tK)}};y=tW;var tH="2025-06-18",tQ=[tH,"2025-03-26","2024-11-05"],tX=w.z.looseObject({name:w.z.string(),version:w.z.string()}),t0=w.z.looseObject({_meta:w.z.optional(w.z.object({}).loose())}),t1=w.z.object({method:w.z.string(),params:w.z.optional(t0)}),t2=w.z.looseObject({experimental:w.z.optional(w.z.object({}).loose()),logging:w.z.optional(w.z.object({}).loose()),prompts:w.z.optional(w.z.looseObject({listChanged:w.z.optional(w.z.boolean())})),resources:w.z.optional(w.z.looseObject({subscribe:w.z.optional(w.z.boolean()),listChanged:w.z.optional(w.z.boolean())})),tools:w.z.optional(w.z.looseObject({listChanged:w.z.optional(w.z.boolean())}))}),t8=t0.extend({protocolVersion:w.z.string(),capabilities:t2,serverInfo:tX,instructions:w.z.optional(w.z.string())}),t4=t0.extend({nextCursor:w.z.optional(w.z.string())}),t6=w.z.object({name:w.z.string(),description:w.z.optional(w.z.string()),inputSchema:w.z.object({type:w.z.literal("object"),properties:w.z.optional(w.z.object({}).loose())}).loose()}).loose(),t7=t4.extend({tools:w.z.array(t6)}),t3=w.z.object({type:w.z.literal("text"),text:w.z.string()}).loose(),t9=w.z.object({type:w.z.literal("image"),data:w.z.base64(),mimeType:w.z.string()}).loose(),t5=w.z.object({uri:w.z.string(),mimeType:w.z.optional(w.z.string())}).loose(),re=t5.extend({text:w.z.string()}),rt=t5.extend({blob:w.z.base64()}),rr=w.z.object({type:w.z.literal("resource"),resource:w.z.union([re,rt])}).loose(),ra=t0.extend({content:w.z.array(w.z.union([t3,t9,rr])),isError:w.z.boolean().default(!1).optional()}).or(t0.extend({toolResult:w.z.unknown()})),ro=w.z.object({jsonrpc:w.z.literal("2.0"),id:w.z.union([w.z.string(),w.z.number().int()])}).merge(t1).strict(),rn=w.z.object({jsonrpc:w.z.literal("2.0"),id:w.z.union([w.z.string(),w.z.number().int()]),result:t0}).strict(),rs=w.z.object({jsonrpc:w.z.literal("2.0"),id:w.z.union([w.z.string(),w.z.number().int()]),error:w.z.object({code:w.z.number().int(),message:w.z.string(),data:w.z.optional(w.z.unknown())})}).strict(),ri=w.z.object({jsonrpc:w.z.literal("2.0")}).merge(w.z.object({method:w.z.string(),params:w.z.optional(t0)})).strict(),rl=w.z.union([ro,ri,rn,rs]),ru=class{constructor({url:e,headers:t}){this.connected=!1,this.url=new URL(e),this.headers=t}async start(){return new Promise((e,t)=>{if(this.connected)return e();this.abortController=new AbortController,(async()=>{var r,a,o;try{let o=new Headers(this.headers);o.set("Accept","text/event-stream");let n=await fetch(this.url.href,{headers:o,signal:null==(r=this.abortController)?void 0:r.signal});if(!n.ok||!n.body){let e=new F({message:`MCP SSE Transport Error: ${n.status} ${n.statusText}`});return null==(a=this.onerror)||a.call(this,e),t(e)}let s=n.body.pipeThrough(new TextDecoderStream).pipeThrough(new EventSourceParserStream).getReader(),i=async()=>{var r,a,o;try{for(;;){let{done:t,value:o}=await s.read();if(t){if(this.connected)throw this.connected=!1,new F({message:"MCP SSE Transport Error: Connection closed unexpectedly"});return}let{event:n,data:i}=o;if("endpoint"===n){if(this.endpoint=new URL(i,this.url),this.endpoint.origin!==this.url.origin)throw new F({message:`MCP SSE Transport Error: Endpoint origin does not match connection origin: ${this.endpoint.origin}`});this.connected=!0,e()}else if("message"===n)try{let e=rl.parse(JSON.parse(i));null==(r=this.onmessage)||r.call(this,e)}catch(t){let e=new F({message:"MCP SSE Transport Error: Failed to parse message",cause:t});null==(a=this.onerror)||a.call(this,e)}}}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(o=this.onerror)||o.call(this,e),t(e)}};this.sseConnection={close:()=>s.cancel()},i()}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(o=this.onerror)||o.call(this,e),t(e)}})()})}async close(){var e,t,r;this.connected=!1,null==(e=this.sseConnection)||e.close(),null==(t=this.abortController)||t.abort(),null==(r=this.onclose)||r.call(this)}async send(e){var t,r,a;if(!this.endpoint||!this.connected)throw new F({message:"MCP SSE Transport Error: Not connected"});try{let a=new Headers(this.headers);a.set("Content-Type","application/json");let o={method:"POST",headers:a,body:JSON.stringify(e),signal:null==(t=this.abortController)?void 0:t.signal},n=await fetch(this.endpoint,o);if(!n.ok){let e=await n.text().catch(()=>null),t=new F({message:`MCP SSE Transport Error: POSTing to endpoint (HTTP ${n.status}): ${e}`});null==(r=this.onerror)||r.call(this,t);return}}catch(e){null==(a=this.onerror)||a.call(this,e);return}}};b.bD;var rp=class{constructor({api:e="/api/chat",credentials:t,headers:r,body:a,fetch:o,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:s}){this.api=e,this.credentials=t,this.headers=r,this.body=a,this.fetch=o,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=s}async sendMessages({abortSignal:e,...t}){var r,a,o,n,s;let i=await (0,v.hd)(this.body),l=await (0,v.hd)(this.headers),u=await (0,v.hd)(this.credentials),p=await (null==(r=this.prepareSendMessagesRequest)?void 0:r.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...i,...t.body},headers:{...l,...t.headers},credentials:u,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),c=null!=(a=null==p?void 0:p.api)?a:this.api,d=(null==p?void 0:p.headers)!==void 0?p.headers:{...l,...t.headers},m=(null==p?void 0:p.body)!==void 0?p.body:{...i,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},h=null!=(o=null==p?void 0:p.credentials)?o:u,f=null!=(n=this.fetch)?n:globalThis.fetch,g=await f(c,{method:"POST",headers:{"Content-Type":"application/json",...d},body:JSON.stringify(m),credentials:h,signal:e});if(!g.ok)throw Error(null!=(s=await g.text())?s:"Failed to fetch the chat response.");if(!g.body)throw Error("The response body is empty.");return this.processResponseStream(g.body)}async reconnectToStream(e){var t,r,a,o,n;let s=await (0,v.hd)(this.body),i=await (0,v.hd)(this.headers),l=await (0,v.hd)(this.credentials),u=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...s,...e.body},headers:{...i,...e.headers},credentials:l,requestMetadata:e.metadata})),p=null!=(r=null==u?void 0:u.api)?r:`${this.api}/${e.chatId}/stream`,c=(null==u?void 0:u.headers)!==void 0?u.headers:{...i,...e.headers},d=null!=(a=null==u?void 0:u.credentials)?a:l,m=null!=(o=this.fetch)?o:globalThis.fetch,h=await m(p,{method:"GET",headers:c,credentials:d});if(204===h.status)return null;if(!h.ok)throw Error(null!=(n=await h.text())?n:"Failed to fetch the chat response.");if(!h.body)throw Error("The response body is empty.");return this.processResponseStream(h.body)}},rc=w.z.object({type:w.z.literal("text"),text:w.z.string(),state:w.z.enum(["streaming","done"]).optional(),providerMetadata:eP.optional()}),rd=w.z.object({type:w.z.literal("reasoning"),text:w.z.string(),state:w.z.enum(["streaming","done"]).optional(),providerMetadata:eP.optional()}),rm=w.z.object({type:w.z.literal("source-url"),sourceId:w.z.string(),url:w.z.string(),title:w.z.string().optional(),providerMetadata:eP.optional()}),rh=w.z.object({type:w.z.literal("source-document"),sourceId:w.z.string(),mediaType:w.z.string(),title:w.z.string(),filename:w.z.string().optional(),providerMetadata:eP.optional()}),rf=w.z.object({type:w.z.literal("file"),mediaType:w.z.string(),filename:w.z.string().optional(),url:w.z.string(),providerMetadata:eP.optional()}),rg=w.z.object({type:w.z.literal("step-start")}),ry=w.z.object({type:w.z.string().startsWith("data-"),id:w.z.string().optional(),data:w.z.unknown()}),rv=[w.z.object({type:w.z.literal("dynamic-tool"),toolName:w.z.string(),toolCallId:w.z.string(),state:w.z.literal("input-streaming"),input:w.z.unknown().optional(),output:w.z.never().optional(),errorText:w.z.never().optional()}),w.z.object({type:w.z.literal("dynamic-tool"),toolName:w.z.string(),toolCallId:w.z.string(),state:w.z.literal("input-available"),input:w.z.unknown(),output:w.z.never().optional(),errorText:w.z.never().optional(),callProviderMetadata:eP.optional()}),w.z.object({type:w.z.literal("dynamic-tool"),toolName:w.z.string(),toolCallId:w.z.string(),state:w.z.literal("output-available"),input:w.z.unknown(),output:w.z.unknown(),errorText:w.z.never().optional(),callProviderMetadata:eP.optional(),preliminary:w.z.boolean().optional()}),w.z.object({type:w.z.literal("dynamic-tool"),toolName:w.z.string(),toolCallId:w.z.string(),state:w.z.literal("output-error"),input:w.z.unknown(),output:w.z.never().optional(),errorText:w.z.string(),callProviderMetadata:eP.optional()})],rb=[w.z.object({type:w.z.string().startsWith("tool-"),toolCallId:w.z.string(),state:w.z.literal("input-streaming"),input:w.z.unknown().optional(),output:w.z.never().optional(),errorText:w.z.never().optional()}),w.z.object({type:w.z.string().startsWith("tool-"),toolCallId:w.z.string(),state:w.z.literal("input-available"),input:w.z.unknown(),output:w.z.never().optional(),errorText:w.z.never().optional(),callProviderMetadata:eP.optional()}),w.z.object({type:w.z.string().startsWith("tool-"),toolCallId:w.z.string(),state:w.z.literal("output-available"),input:w.z.unknown(),output:w.z.unknown(),errorText:w.z.never().optional(),callProviderMetadata:eP.optional(),preliminary:w.z.boolean().optional()}),w.z.object({type:w.z.string().startsWith("tool-"),toolCallId:w.z.string(),state:w.z.literal("output-error"),input:w.z.unknown(),output:w.z.never().optional(),errorText:w.z.string(),callProviderMetadata:eP.optional()})];w.z.object({id:w.z.string(),role:w.z.enum(["system","user","assistant"]),metadata:w.z.unknown().optional(),parts:w.z.array(w.z.union([rc,rd,rm,rh,rf,rg,ry,...rv,...rb]))})}}]);